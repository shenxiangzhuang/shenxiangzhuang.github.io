<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"datahonor.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":"ture"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Overview 我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。  An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) a">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV系列笔记十三：Computing an image histogram">
<meta property="og:url" content="http://datahonor.com/2017/05/02/Computing-an-image-histogram/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="Overview 我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。  An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) a">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170502/hist1.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170502/hist2.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050511%3A02%3A11.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050512%3A26%3A29.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050501.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050502.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050503.png">
<meta property="og:image" content="http://blog-1252464519.costj.myqcloud.com/170505/cmphists.png">
<meta property="article:published_time" content="2017-05-02T08:34:26.000Z">
<meta property="article:modified_time" content="2022-03-13T04:35:03.456Z">
<meta property="article:author" content="Mathew Shen">
<meta property="article:tag" content="Cpp">
<meta property="article:tag" content="OpenCV">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog-1252464519.costj.myqcloud.com/170502/hist1.png">


<link rel="canonical" href="http://datahonor.com/2017/05/02/Computing-an-image-histogram/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://datahonor.com/2017/05/02/Computing-an-image-histogram/","path":"2017/05/02/Computing-an-image-histogram/","title":"OpenCV系列笔记十三：Computing an image histogram"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OpenCV系列笔记十三：Computing an image histogram | DATA HONOR</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DATA HONOR</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Pain Is Inevitable; Suffering Is Optional</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Overview-8"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code-8"><span class="nav-number">2.</span> <span class="nav-text">Code</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E9%80%9A%E9%81%93-%E7%81%B0%E5%BA%A6%E5%9B%BE"><span class="nav-number">2.1.</span> <span class="nav-text">单通道[灰度图]</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#grayhistogram-h"><span class="nav-number">2.1.1.</span> <span class="nav-text">grayhistogram.h</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#main-cpp-3"><span class="nav-number">2.1.2.</span> <span class="nav-text">main.cpp</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%9A%E9%80%9A%E9%81%93-%E5%BD%A9%E8%89%B2"><span class="nav-number">2.2.</span> <span class="nav-text">多通道[彩色]</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#main-cpp-4"><span class="nav-number">2.2.1.</span> <span class="nav-text">main.cpp</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E7%9A%84%E4%BF%AE%E6%AD%A3"><span class="nav-number">2.3.</span> <span class="nav-text">直方图的修正</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E7%9A%84%E5%9D%87%E8%A1%A1%E5%8C%96-histogram-equalization"><span class="nav-number">2.3.1.</span> <span class="nav-text">直方图的均衡化(histogram equalization)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E7%9A%84%E8%A7%84%E5%AE%9A%E5%8C%96-histogram-specification-matching"><span class="nav-number">2.3.2.</span> <span class="nav-text">直方图的规定化(histogram specification&#x2F;matching)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E6%AF%94%E8%BE%83"><span class="nav-number">3.</span> <span class="nav-text">直方图比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Refrence"><span class="nav-number">4.</span> <span class="nav-text">Refrence</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mathew Shen"
      src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  <p class="site-author-name" itemprop="name">Mathew Shen</p>
  <div class="site-description" itemprop="description">十年饮冰，难凉热血。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenxiangzhuang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenxiangzhuang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:datahonor@gmail.com" title="E-Mail → mailto:datahonor@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://yuanhang0.github.io/" title="https:&#x2F;&#x2F;yuanhang0.github.io&#x2F;" rel="noopener" target="_blank">Tomorrow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yudaer.github.io/" title="http:&#x2F;&#x2F;yudaer.github.io&#x2F;" rel="noopener" target="_blank">小白二号</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/02/Computing-an-image-histogram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="OpenCV系列笔记十三：Computing an image histogram | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenCV系列笔记十三：Computing an image histogram
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-02 16:34:26" itemprop="dateCreated datePublished" datetime="2017-05-02T16:34:26+08:00">2017-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/02/Computing-an-image-histogram/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/02/Computing-an-image-histogram/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h4 id="Overview-8">Overview</h4>
<p>我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。</p>
<blockquote>
<p>An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) and 255 (white). Depending on the picture content, you will find different amounts of each gray shade laid out inside the image. A histogram is a simple table that gives you the number of pixels that have a given value in an image (or sometimes, a set of images). The histogram of a gray-level image will, therefore, have 256 entries (or bins). Bin 0 gives you the number of pixels that have the value 0, bin 1 gives you the number of pixels that have the value 1, and so on. Obviously, if you sum all of the entries of a histogram, you should get the total number of pixels. Histograms can also be normalized so that the sum of the bins equals 1. In this case, each bin gives you the percentage of pixels that have this specific value in the image.</p>
</blockquote>
<p>下面我们分别给出单通道[灰度图]和三通道图像直方图的绘制，前者来自这系列笔记的参考书，后者来自官方文档，其实基本思路是一致的。</p>
<h4 id="Code-8">Code</h4>
<h5 id="单通道-灰度图">单通道[灰度图]</h5>
<h6 id="grayhistogram-h">grayhistogram.h</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CLIONS_GRAYHISTOGRAM_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLIONS_GRAYHISTOGRAM_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;highgui.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Histogram1D</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> histSize[<span class="number">1</span>]; <span class="comment">// numbers of bins in histogram</span></span><br><span class="line">    <span class="type">float</span> hranges[<span class="number">2</span>];  <span class="comment">// range of values</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span>* ranges[<span class="number">1</span>];  <span class="comment">// pointer to the value ranges</span></span><br><span class="line">    <span class="type">int</span> channels[<span class="number">1</span>]; <span class="comment">// channel number to be examined</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Histogram1D</span>()&#123;</span><br><span class="line">        <span class="comment">// Prepare default arguments for 1D histogram</span></span><br><span class="line">        histSize[<span class="number">0</span>] = <span class="number">256</span>;  <span class="comment">// 256bins</span></span><br><span class="line">        hranges[<span class="number">0</span>] = <span class="number">0.0</span>;  <span class="comment">// from 0 (inclusive)</span></span><br><span class="line">        hranges[<span class="number">1</span>] = <span class="number">256.0</span>;  <span class="comment">// to 256 (exclusive)</span></span><br><span class="line">        ranges[<span class="number">0</span>] = hranges;</span><br><span class="line">        channels[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// we look at channel 0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setNBins</span><span class="params">(<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">        histSize[<span class="number">0</span>] = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Computes the 1D histogram</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">        cv::Mat hist;</span><br><span class="line">        <span class="comment">//Compute 1D histogram with calcHist</span></span><br><span class="line">        cv::<span class="built_in">calcHist</span>(&amp;image,<span class="number">1</span>,channels,cv::<span class="built_in">Mat</span>(),</span><br><span class="line">                     hist, <span class="number">1</span>, histSize, ranges);</span><br><span class="line">        <span class="keyword">return</span>  hist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Compute the 1D histogram and returns an image of it</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getHistogramImage</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image, <span class="type">int</span> zoom=<span class="number">1</span>)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Compute histogram first</span></span><br><span class="line">        cv::Mat hist = <span class="built_in">getHistogram</span>(image);</span><br><span class="line">        <span class="comment">// Create imaeg</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getImageOfHistogram</span>(hist, zoom);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an image representing a histogram (static method)</span></span><br><span class="line">    <span class="function"><span class="type">static</span> cv::Mat <span class="title">getImageOfHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;hist, <span class="type">int</span> zoom)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Get min and max bin values</span></span><br><span class="line">        <span class="type">double</span> maxVal = <span class="number">0</span>;</span><br><span class="line">        <span class="type">double</span> minVal = <span class="number">0</span>;</span><br><span class="line">        cv::<span class="built_in">minMaxLoc</span>(hist, &amp;minVal, &amp;maxVal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//get histogram size</span></span><br><span class="line">        <span class="type">int</span> histSize = hist.rows;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Square image on which to display histogram</span></span><br><span class="line">        <span class="function">cv::Mat <span class="title">histImg</span><span class="params">(histSize*zoom, histSize*zoom, CV_8U, cv::Scalar(<span class="number">255</span>))</span></span>;</span><br><span class="line">        <span class="comment">// set highest point at 90% of nbins (i.e. image height)</span></span><br><span class="line">        <span class="type">int</span> hpt = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.9</span>*histSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Draw vertical line for each bin</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> h=<span class="number">0</span>; h&lt;histSize; h++)&#123;</span><br><span class="line">            <span class="type">float</span> binVal = hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(h);</span><br><span class="line">            <span class="keyword">if</span>(binVal&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> intensity = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(binVal*hpt/maxVal);</span><br><span class="line">                cv::<span class="built_in">line</span>(histImg, cv::<span class="built_in">Point</span>(h*zoom, histSize*zoom), cv::<span class="built_in">Point</span>(h*zoom, (histSize - intensity)*zoom),cv::<span class="built_in">Scalar</span>(<span class="number">0</span>),zoom);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> histImg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CLIONS_GRAYHISTOGRAM_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="main-cpp-3">main.cpp</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;imageInfo.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png&quot;</span>,<span class="number">0</span>); <span class="comment">// gray</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line">    <span class="comment">// The histogram object</span></span><br><span class="line">    Histogram1D h;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Compute the histogram</span></span><br><span class="line">    cv::Mat histo = h.<span class="built_in">getHistogram</span>(image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Loop over each bin</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)&#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;Value &quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot; = &quot;</span></span><br><span class="line">                              &lt;&lt;histo.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i)&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Histogram&quot;</span>, h.<span class="built_in">getHistogramImage</span>(image));</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>Value 0 = 73<br>
Value 1 = 94<br>
Value 2 = 288<br>
Value 3 = 157<br>
…</p>
</blockquote>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170502/hist1.png" alt=""></p>
<h5 id="多通道-彩色">多通道[彩色]</h5>
<h6 id="main-cpp-4">main.cpp</h6>
<p>这里，为了更好地展示图片，我们仿照上面的方法，对文档代码进行了修改。主要就是动态限制了直方图高度。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgcodecs.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Mat src, dst;</span><br><span class="line">    src = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png&quot;</span>, IMREAD_COLOR);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(src.<span class="built_in">empty</span>()) <span class="keyword">return</span>  <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, src);</span><br><span class="line"></span><br><span class="line">    vector&lt;Mat&gt;bgr_planes;</span><br><span class="line">    <span class="built_in">split</span>(src, bgr_planes);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> histSize[<span class="number">1</span>];</span><br><span class="line">    histSize[<span class="number">0</span>] = <span class="number">256</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> range[] = &#123;<span class="number">0</span>, <span class="number">256</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span>* histRange[<span class="number">2</span>] = &#123;range&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> uniform = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">bool</span> accumulate = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    Mat b_hist, g_hist, r_hist;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">calcHist</span>(&amp;bgr_planes[<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">Mat</span>(), b_hist, <span class="number">1</span>, histSize, histRange, uniform, accumulate);</span><br><span class="line">    <span class="built_in">calcHist</span>(&amp;bgr_planes[<span class="number">1</span>], <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">Mat</span>(), g_hist, <span class="number">1</span>, histSize, histRange, uniform, accumulate);</span><br><span class="line">    <span class="built_in">calcHist</span>(&amp;bgr_planes[<span class="number">2</span>], <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">Mat</span>(), r_hist, <span class="number">1</span>, histSize, histRange, uniform, accumulate);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Draw the histograms for B, G, and R</span></span><br><span class="line">    <span class="type">double</span> maxVal = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> minVal = <span class="number">0</span>;</span><br><span class="line">    cv::<span class="built_in">minMaxLoc</span>(b_hist, &amp;minVal, &amp;maxVal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">minMaxLoc</span>(g_hist, &amp;minVal, &amp;maxVal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">minMaxLoc</span>(r_hist, &amp;minVal, &amp;maxVal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hpt = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.9</span>*histSize[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hist_w = <span class="number">512</span>; <span class="type">int</span> hist_h = <span class="number">400</span>;</span><br><span class="line">    <span class="type">int</span> bin_w = <span class="built_in">cvRound</span>((<span class="type">double</span>)hist_w / histSize[<span class="number">0</span>]);</span><br><span class="line">    <span class="function">Mat <span class="title">histImage</span><span class="params">(hist_h, hist_w, CV_8UC3, Scalar(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// normalization</span></span><br><span class="line">    <span class="built_in">normalize</span>(b_hist, b_hist, <span class="number">0</span>, histImage.rows, NORM_MINMAX, <span class="number">-1</span>, <span class="built_in">Mat</span>());</span><br><span class="line">    <span class="built_in">normalize</span>(b_hist, b_hist, <span class="number">0</span>, histImage.rows, NORM_MINMAX, <span class="number">-1</span>, <span class="built_in">Mat</span>());</span><br><span class="line">    <span class="built_in">normalize</span>(b_hist, b_hist, <span class="number">0</span>, histImage.rows, NORM_MINMAX, <span class="number">-1</span>, <span class="built_in">Mat</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;histSize[<span class="number">0</span>]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">line</span>(histImage, <span class="built_in">Point</span>(bin_w*(i<span class="number">-1</span>), hist_h - <span class="built_in">cvRound</span>(b_hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i<span class="number">-1</span>)*hpt/maxVal)),</span><br><span class="line">                        <span class="built_in">Point</span>(bin_w*i, hist_h - <span class="built_in">cvRound</span>(b_hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i)*hpt/maxVal)),</span><br><span class="line">                        <span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">line</span>(histImage, <span class="built_in">Point</span>(bin_w*(i<span class="number">-1</span>), hist_h - <span class="built_in">cvRound</span>(g_hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i<span class="number">-1</span>)*hpt/maxVal)),</span><br><span class="line">             <span class="built_in">Point</span>(bin_w*i, hist_h - <span class="built_in">cvRound</span>(g_hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i)*hpt/maxVal)),</span><br><span class="line">             <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">line</span>(histImage, <span class="built_in">Point</span>(bin_w*(i<span class="number">-1</span>), hist_h - <span class="built_in">cvRound</span>(r_hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i<span class="number">-1</span>)*hpt/maxVal)),</span><br><span class="line">             <span class="built_in">Point</span>(bin_w*i, hist_h - <span class="built_in">cvRound</span>(r_hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i)*hpt/maxVal)),</span><br><span class="line">             <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;calcHist&quot;</span>, histImage);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170502/hist2.png" alt=""></p>
<h5 id="直方图的修正">直方图的修正</h5>
<p>先来看下什么是图像增强技术：</p>
<blockquote>
<p>图像增强技术是一大类基本的图像处理技术，目的是对一幅图像进行 加工，突出图像中的某些信息，削弱或除去某些不需要的信息，以得 到对具体应用来说视觉效果更好、更有用的图像，或转换成一种更适<br>
合人或机器进行分析处理的形式。</p>
</blockquote>
<p>而图像增强方法分为空间域法和频率域法，空间域法是指在空间域内直接对像素的灰度值进行运算处理，我们这里将要介绍的直方图的修正，还有在下一篇笔记<a href="http://datahonor.com/2017/05/04/Look-up-tables/">look-ip table</a><br>
里面用到了灰度变换都属于常用的空间域法。与之对应的频率域法是一种间接的处理方法。它是在图像的某种变换宇内，对图像的变换值进行增强处理，然后通过逆变换获得增强图像。</p>
<h6 id="直方图的均衡化-histogram-equalization">直方图的均衡化(histogram equalization)</h6>
<p>均衡化的原理是使得变换后的图像灰度的概率密度均匀分布，即变换后的图像是衣服灰度级均匀分布的图像，这意味着图像灰度的动态范围得到了增加，从而可提高图像的对比度。<br>
转换过程类似这种形式：<br>
<img src="" alt=""></p>
<p>简单讲就是转换为其累计密度分布的形式。具体的推导过程见参考资料。</p>
<p>在OpenCV中已经有了相应的函数，我们来看下它的效果：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cv::Mat image;</span><br><span class="line">    Histogram1D h;</span><br><span class="line"></span><br><span class="line">    image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/dark.jpeg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Hist&quot;</span>, h.<span class="built_in">getHistogramImage</span>(image));</span><br><span class="line"></span><br><span class="line">    cv::Mat equed;</span><br><span class="line">    cv::<span class="built_in">equalizeHist</span>(image, equed);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Equed&quot;</span>, equed);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Equed Hist&quot;</span>, h.<span class="built_in">getHistogramImage</span>(equed));</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050511%3A02%3A11.png" alt=""></p>
<h6 id="直方图的规定化-histogram-specification-matching">直方图的规定化(histogram specification/matching)</h6>
<p>定义：</p>
<blockquote>
<p>是指将一幅图像通过灰度变换后，使其具有特定的直方图形式，如使图像与某一标准图像具有相同的直方图，或使图像具有某一特定函数形式的直方图。</p>
</blockquote>
<p>可以看到规定化是将原来的直方图转化为指定的形式。先将两个图像都进行均衡化处理，之后让被转化的直方图向目标直方图靠拢来得到目的。</p>
<p>在OpenCV中没有特定函数实现规定化，我从Scribd找来实现的代码，参考一下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">grayImgSpecification</span><span class="params">(cv::Mat &amp;img1, cv::Mat &amp;img2)</span></span>&#123;</span><br><span class="line">    cv::Mat img_new = img1.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="type">int</span> grayLevel = <span class="number">256</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Histogram</span></span><br><span class="line">    Histogram1D h;</span><br><span class="line">    cv::Mat histogram1 = h.<span class="built_in">getHistogram</span>(img1);</span><br><span class="line">    cv::Mat histogram2 = h.<span class="built_in">getHistogram</span>(img2);</span><br><span class="line"><span class="comment">//    cv::imshow(&quot;img1-original histogram&quot;, h.getHistogramImage(img1));</span></span><br><span class="line"><span class="comment">//    cv::imshow(&quot;img2-original histogram&quot;, h.getHistogramImage(img2));</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Specifuication</span></span><br><span class="line">    <span class="type">float</span> * prImg1 = <span class="keyword">new</span> <span class="type">float</span>[grayLevel];</span><br><span class="line">    <span class="type">float</span> * mapImg1 = <span class="keyword">new</span> <span class="type">float</span>[grayLevel];</span><br><span class="line">    <span class="type">float</span> * prImg2 = <span class="keyword">new</span> <span class="type">float</span>[grayLevel];</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> n1 = img1.rows * img1.cols;</span><br><span class="line">    <span class="type">float</span> n2 = img2.rows * img2.cols;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不同灰度级所占的比例</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;grayLevel; i++ )&#123;</span><br><span class="line">        <span class="type">float</span> nk = histogram1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i);</span><br><span class="line">        prImg1[i] = nk/n1;</span><br><span class="line"></span><br><span class="line">        nk = histogram2.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i);</span><br><span class="line">        prImg2[i] = nk/n2;</span><br><span class="line"></span><br><span class="line">        mapImg1[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 累加</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;grayLevel; i++)&#123;</span><br><span class="line">        prImg1[i] = prImg1[i<span class="number">-1</span>] + prImg1[i];</span><br><span class="line">        prImg2[i] = prImg2[i<span class="number">-1</span>] + prImg2[i];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    prImg1[grayLevel - <span class="number">1</span>] = prImg2[grayLevel - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mapping</span></span><br><span class="line">    <span class="type">int</span> currentID = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;grayLevel; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> mapped = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span>(mapped== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(prImg1[i] &lt;= prImg2[currentID])</span><br><span class="line">            &#123;</span><br><span class="line">                mapImg1[i] = currentID;</span><br><span class="line">                mapped = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                currentID++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// new Image</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;img_new.rows; i++)&#123;</span><br><span class="line">        uchar* data = img_new.<span class="built_in">ptr</span>&lt;uchar&gt;(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;img_new.cols;j++)&#123;</span><br><span class="line">            <span class="type">int</span> grayVale = (<span class="type">int</span>)data[j*img_new.<span class="built_in">channels</span>()+<span class="number">0</span>];</span><br><span class="line">            <span class="type">float</span> val = mapImg1[grayVale];</span><br><span class="line">            data[j*img_new.<span class="built_in">channels</span>()+<span class="number">0</span>] = val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img_new;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Read image</span></span><br><span class="line">    cv::Mat img1 = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/desert.jpg&quot;</span>);</span><br><span class="line">    cv::Mat img2 = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/sea.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// split</span></span><br><span class="line">    std::vector&lt;cv::Mat&gt;img1_bgrplanes;</span><br><span class="line">    cv::<span class="built_in">split</span>(img1, img1_bgrplanes);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;cv::Mat&gt;img2_bgrplanes;</span><br><span class="line">    cv::<span class="built_in">split</span>(img2, img2_bgrplanes);</span><br><span class="line"></span><br><span class="line">    cv::Mat img_new0 = <span class="built_in">grayImgSpecification</span>(img1_bgrplanes[<span class="number">0</span>], img2_bgrplanes[<span class="number">0</span>]);</span><br><span class="line">    cv::Mat img_new1 = <span class="built_in">grayImgSpecification</span>(img1_bgrplanes[<span class="number">1</span>], img2_bgrplanes[<span class="number">1</span>]);</span><br><span class="line">    cv::Mat img_new2 = <span class="built_in">grayImgSpecification</span>(img1_bgrplanes[<span class="number">2</span>], img2_bgrplanes[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    cv::Mat img_news;</span><br><span class="line">    std::vector&lt;cv::Mat&gt;img_new_planes;</span><br><span class="line">    img_new_planes= &#123;img_new0, img_new1, img_new2&#125;;</span><br><span class="line">    cv::<span class="built_in">merge</span>(img_new_planes, img_news);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Img_news&quot;</span>, img_news);</span><br><span class="line">    cv::<span class="built_in">imwrite</span>(<span class="string">&quot;specification.jpg&quot;</span>, img_news);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050512%3A26%3A29.png" alt=""></p>
<p>根据上面已经提到的，我们来获取原来的图片和新生成图片的彩色直方图：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050501.png" alt=""></p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050502.png" alt=""></p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/Selection_050503.png" alt=""></p>
<p>可以看到，最后生成的直方图和目标直方图(sea-hist)是基本一致的，这样就是达到了正规化的目的。</p>
<h4 id="直方图比较">直方图比较</h4>
<p>我们也可以通过比较直方图来检测图像的相似度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;colorhistogram.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImageCompparator</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    cv::Mat refH;  <span class="comment">// reference histogram</span></span><br><span class="line">    cv::Mat inputH;  <span class="comment">// histogram of input image</span></span><br><span class="line"></span><br><span class="line">    ColorHistogram hist;  <span class="comment">// to generate the histograms number of bins used in each color channel</span></span><br><span class="line">    <span class="type">int</span> nBins;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ImageCompparator</span>():<span class="built_in">nBins</span>(<span class="number">8</span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set and compute histogram of reference image</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setReferenceImage</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">        hist.<span class="built_in">setSize</span>(nBins);</span><br><span class="line">        refH = hist.<span class="built_in">getHistogram</span>(image);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// comapre the image using their BGR histograms</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">compare</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">        inputH = hist.<span class="built_in">getHistogram</span>(image);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//histogram comparison using intersection</span></span><br><span class="line">        <span class="keyword">return</span> cv::<span class="built_in">compareHist</span>(refH, inputH, cv::HISTCMP_INTERSECT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image;</span><br><span class="line">    image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/waves.jpg&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    ImageCompparator c;</span><br><span class="line">    c.<span class="built_in">setReferenceImage</span>(image);</span><br><span class="line"></span><br><span class="line">    cv::Mat wave, beach, cattle;</span><br><span class="line">    wave = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/waves.jpg&quot;</span>);  <span class="comment">// 和自身比较</span></span><br><span class="line">    beach = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/beach.jpg&quot;</span>);  <span class="comment">// 和较为相似的比较</span></span><br><span class="line">    cattle = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png&quot;</span>);  <span class="comment">// 和不相似的比较</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> waves = c.<span class="built_in">compare</span>(wave);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;wave&#x27;s score: &quot;</span>+std::<span class="built_in">to_string</span>(waves), wave);</span><br><span class="line">    <span class="type">double</span> beachs = c.<span class="built_in">compare</span>(beach);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;beach&#x27;s score: &quot;</span>+std::<span class="built_in">to_string</span>(beachs), beach);</span><br><span class="line">    <span class="type">double</span> cattles = c.<span class="built_in">compare</span>(cattle);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;cattle&#x27;s score: &quot;</span>+std::<span class="built_in">to_string</span>(cattles), cattle);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170505/cmphists.png" alt=""></p>
<h4 id="Refrence">Refrence</h4>
<p><a target="_blank" rel="noopener" href="https://www.scribd.com/document/106790597/OPENCV-Topic-04-Histogram-Specification">Scribd代码</a></p>
<p><a target="_blank" rel="noopener" href="http://bj3s.pku.edu.cn/activity/subjects/lesson6.pdf">北大遥感课件</a></p>
<p>山东科大《数字图像处理》</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Cpp/" rel="tag"># Cpp</a>
              <a href="/tags/OpenCV/" rel="tag"># OpenCV</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/05/02/Using-colors-for-detection-skin-tone-detection/" rel="prev" title="OpenCV系列笔记十二：Using colors for detection - skin tone detection">
                  <i class="fa fa-chevron-left"></i> OpenCV系列笔记十二：Using colors for detection - skin tone detection
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/05/04/Look-up-tables/" rel="next" title="OpenCV系列笔记十四：Look-up tables">
                  OpenCV系列笔记十四：Look-up tables <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="valine-comments"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mathew Shen</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




<script class="next-config" data-name="valine" type="application/json">{"enable":true,"appId":"qzF75hQvs6yPkMIO7gd7LwDB-gzGzoHsz","appKey":"foULNoeGLTL8LE8C2Ysitv5I","serverURLs":["datahonor.com"],"placeholder":"毕竟今天太阳那么好~(评论时留下邮箱才能收到回复提醒的邮件哦)","avatar":"","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick"],"notify":true,"el":"#valine-comments","path":"/2017/05/02/Computing-an-image-histogram/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.valine.el)
    .then(() => NexT.utils.getScript(
      'https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js',
      { condition: window.Valine }
    ))
    .then(() => {
      new Valine(CONFIG.valine);
    });
});
</script>

</body>
</html>
