<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"datahonor.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":"ture"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Overview 关于图片关键点的检测中，corner点的检测。  When searching for interesting feature points in images, corners come out as an interesting solution. They are indeed local features that can be easily localized in a">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV系列笔记二十四：Detecting corners in an image">
<meta property="og:url" content="http://datahonor.com/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="Overview 关于图片关键点的检测中，corner点的检测。  When searching for interesting feature points in images, corners come out as an interesting solution. They are indeed local features that can be easily localized in a">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://otdfzpvtk.bkt.clouddn.com/Selection_072001.png">
<meta property="article:published_time" content="2017-07-20T03:43:58.000Z">
<meta property="article:modified_time" content="2022-03-13T04:35:03.456Z">
<meta property="article:author" content="Mathew Shen">
<meta property="article:tag" content="Cpp">
<meta property="article:tag" content="OpenCV">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://otdfzpvtk.bkt.clouddn.com/Selection_072001.png">


<link rel="canonical" href="http://datahonor.com/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://datahonor.com/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/","path":"2017/07/20/OpenCV系列笔记二十四：Detecting-corners-in-an-image/","title":"OpenCV系列笔记二十四：Detecting corners in an image"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OpenCV系列笔记二十四：Detecting corners in an image | DATA HONOR</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DATA HONOR</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Pain Is Inevitable; Suffering Is Optional</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Overview-37"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code-30"><span class="nav-number">2.</span> <span class="nav-text">Code</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#harrisDetector-h"><span class="nav-number">2.1.</span> <span class="nav-text">harrisDetector.h</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#main-cpp-6"><span class="nav-number">2.2.</span> <span class="nav-text">main.cpp</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mathew Shen"
      src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  <p class="site-author-name" itemprop="name">Mathew Shen</p>
  <div class="site-description" itemprop="description">十年饮冰，难凉热血。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenxiangzhuang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenxiangzhuang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:datahonor@gmail.com" title="E-Mail → mailto:datahonor@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://yuanhang0.github.io/" title="https:&#x2F;&#x2F;yuanhang0.github.io&#x2F;" rel="noopener" target="_blank">Tomorrow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yudaer.github.io/" title="http:&#x2F;&#x2F;yudaer.github.io&#x2F;" rel="noopener" target="_blank">小白二号</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="OpenCV系列笔记二十四：Detecting corners in an image | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenCV系列笔记二十四：Detecting corners in an image
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-07-20 11:43:58" itemprop="dateCreated datePublished" datetime="2017-07-20T11:43:58+08:00">2017-07-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h4 id="Overview-37">Overview</h4>
<p>关于图片关键点的检测中，corner点的检测。</p>
<blockquote>
<p>When searching for interesting feature points in images, corners come out as an interesting solution. They are indeed local features that can be easily localized in an image, and in addition, they should abound in scenes of man-made objects (where they are produced by walls, doors, windows, tables, and so on).</p>
</blockquote>
<p>这里主要是基于Harris feature detector的实现。</p>
<p>首先是corners的定义：</p>
<blockquote>
<p>To define the notion of corners in images, the Harris feature detector looks at the average directional change in intensity in a small window around a putative interest point… This average intensity change can then be computed in all possible directions, which leads to the definition of a corner as a point for which the average change is high in more than one direction.</p>
</blockquote>
<p>这里的公式没有看太懂，大致就是利用梯度找到对比度较强的点作为corner.</p>
<p>这里首先介绍了经典的Harris feature detector的实现，接着针对feature point clustering问题给出了两种解决的办法，分别是non-maxima suppression，通过dilate操作来实现；还有GFTT（good-features-to-track），通过设置两个interest points 之间的最小距离来解决。</p>
<h4 id="Code-30">Code</h4>
<h5 id="harrisDetector-h">harrisDetector.h</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by shensir on 17-7-20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CLIONS_HARRISDETECTOR_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLIONS_HARRISDETECTOR_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core/mat.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">harrisDetector</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 32-it float image of corner strength</span></span><br><span class="line">    cv::Mat cornerStrength;</span><br><span class="line">    <span class="comment">// 32-bit float image of thresholded corners</span></span><br><span class="line">    cv::Mat cornerTh;</span><br><span class="line">    <span class="comment">// image of local maxima(internal)</span></span><br><span class="line">    cv::Mat localMax;</span><br><span class="line">    <span class="comment">// size of neighborhood for derivatives smoothing</span></span><br><span class="line">    <span class="type">int</span> neighborhood;</span><br><span class="line">    <span class="comment">// aperture for gradient computation</span></span><br><span class="line">    <span class="type">int</span> aperture;</span><br><span class="line">    <span class="comment">// Harris parameter</span></span><br><span class="line">    <span class="type">double</span> k;</span><br><span class="line">    <span class="comment">// maximum strength for threshold computation</span></span><br><span class="line">    <span class="type">double</span> maxStrength;</span><br><span class="line">    <span class="comment">// calculated threshold(internal)</span></span><br><span class="line">    <span class="type">double</span> threshold;</span><br><span class="line">    <span class="comment">// size of neighborhood for non-max suppression</span></span><br><span class="line">    <span class="type">int</span> nonMaxSize;</span><br><span class="line">    <span class="comment">// kernel for non-max suppression</span></span><br><span class="line">    cv::Mat kernel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">harrisDetector</span>():<span class="built_in">neighborhood</span>(<span class="number">3</span>), <span class="built_in">aperture</span>(<span class="number">3</span>),</span><br><span class="line">                     <span class="built_in">k</span>(<span class="number">0.01</span>), <span class="built_in">maxStrength</span>(<span class="number">0.0</span>),</span><br><span class="line">                     <span class="built_in">threshold</span>(<span class="number">0.01</span>), <span class="built_in">nonMaxSize</span>(<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="comment">// create kernel used in non-maxima suppression</span></span><br><span class="line">        <span class="built_in">setLocalMaxWindowSize</span>(nonMaxSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create kernel used in non-maxima suppression</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLocalMaxWindowSize</span><span class="params">(<span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        nonMaxSize= size;</span><br><span class="line">        kernel.<span class="built_in">create</span>(nonMaxSize,nonMaxSize,CV_8U);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// compute Harris corners</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">detect</span><span class="params">(<span class="type">const</span> cv::Mat&amp; image)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Harris computation</span></span><br><span class="line">        cv::<span class="built_in">cornerHarris</span>(image, cornerStrength,</span><br><span class="line">        neighborhood, aperture, k);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// internal threshold computation</span></span><br><span class="line">        cv::<span class="built_in">minMaxLoc</span>(cornerStrength, <span class="number">0</span>, &amp;maxStrength);</span><br><span class="line">        <span class="comment">// local maxima detection</span></span><br><span class="line">        cv::Mat dilated;</span><br><span class="line">        cv::<span class="built_in">dilate</span>(cornerStrength, dilated, cv::<span class="built_in">Mat</span>());</span><br><span class="line">        cv::<span class="built_in">compare</span>(cornerStrength, dilated, localMax, cv::CMP_EQ);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the corner map from the computed Harris values</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getCornerMap</span><span class="params">(<span class="type">double</span> qualityLevel)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        cv::Mat cornerMap;</span><br><span class="line">        <span class="comment">// thresholding the corner strength</span></span><br><span class="line">        threshold = qualityLevel*maxStrength;</span><br><span class="line">        cv::<span class="built_in">threshold</span>(cornerStrength, cornerTh, threshold,</span><br><span class="line">        <span class="number">255</span>, cv::THRESH_BINARY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// convert to 8-bit image</span></span><br><span class="line">        cornerTh.<span class="built_in">convertTo</span>(cornerMap, CV_8U);</span><br><span class="line">        <span class="comment">// not-maxima suppression</span></span><br><span class="line">        cv::<span class="built_in">bitwise_and</span>(cornerMap, localMax, cornerMap);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cornerMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the feature points from the computed Harris values</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getCorners</span><span class="params">(std::vector&lt;cv::Point&gt;&amp;points, <span class="type">double</span> qualityLeves)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Get the corner map</span></span><br><span class="line">        cv::Mat cornerMap = <span class="built_in">getCornerMap</span>(qualityLeves);</span><br><span class="line">        <span class="comment">// Get the corners</span></span><br><span class="line">        <span class="built_in">getCorners</span>(points, cornerMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the feature points from the computed corner mao</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getCorners</span><span class="params">(std::vector&lt;cv::Point&gt;&amp;points,</span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="type">const</span> cv::Mat&amp; cornerMap)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Iterate over the pixels to obtain all features</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">0</span>; y &lt; cornerMap.rows; y++)&#123;</span><br><span class="line">            <span class="type">const</span> uchar* rowPtr = cornerMap.<span class="built_in">ptr</span>&lt;uchar&gt;(y);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">0</span>; x &lt; cornerMap.cols; x++)&#123;</span><br><span class="line">                <span class="comment">// if it is a feature point</span></span><br><span class="line">                <span class="keyword">if</span>(rowPtr[x])&#123;</span><br><span class="line">                    points.<span class="built_in">push_back</span>(cv::<span class="built_in">Point</span>(x, y));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Draw circles at feature point locations on an image</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawOnImage</span><span class="params">(cv::Mat&amp; image,</span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="type">const</span> std::vector&lt;cv::Point&gt;&amp;points,</span></span></span><br><span class="line"><span class="params"><span class="function">                    cv::Scalar color = cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="type">int</span> radius=<span class="number">3</span>, <span class="type">int</span> thickness=<span class="number">1</span>)</span></span>&#123;</span><br><span class="line">        std::vector&lt;cv::Point&gt;::const_iterator it = points.<span class="built_in">begin</span>();</span><br><span class="line">        <span class="comment">// for all corners</span></span><br><span class="line">        <span class="keyword">while</span> (it != points.<span class="built_in">end</span>())&#123;</span><br><span class="line">            <span class="comment">// draw a circle at each corner location</span></span><br><span class="line">            cv::<span class="built_in">circle</span>(image, *it, radius, color, thickness);</span><br><span class="line">            ++it;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CLIONS_HARRISDETECTOR_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="main-cpp-6">main.cpp</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;harrisDetector.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">findHarrisCorner</span><span class="params">(<span class="type">const</span> Mat image)</span></span>&#123;</span><br><span class="line">    Mat HarriCorner;</span><br><span class="line">    <span class="built_in">cornerHarris</span>(image,</span><br><span class="line">                HarriCorner,</span><br><span class="line">                <span class="number">3</span>,</span><br><span class="line">                <span class="number">3</span>,</span><br><span class="line">                <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">    Mat HarriCornerThreshed;</span><br><span class="line">    <span class="type">double</span> thresholdNum = <span class="number">0.0001</span>;</span><br><span class="line">    <span class="built_in">threshold</span>(HarriCorner, HarriCornerThreshed,</span><br><span class="line">                thresholdNum, <span class="number">255</span>, THRESH_BINARY_INV);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HarriCornerThreshed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">MGFTT</span><span class="params">(Mat image)</span></span>&#123;</span><br><span class="line">    <span class="comment">// Compute good features to track</span></span><br><span class="line">    std::vector&lt;cv::KeyPoint&gt;keypoints;</span><br><span class="line">    <span class="comment">// GFTT detector</span></span><br><span class="line">    cv::Ptr&lt;cv::GFTTDetector&gt;ptrGFTT =</span><br><span class="line">            cv::GFTTDetector::<span class="built_in">create</span>(</span><br><span class="line">                    <span class="number">500</span>,</span><br><span class="line">                    <span class="number">0.01</span>,</span><br><span class="line">                    <span class="number">10</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// detect the GFTT</span></span><br><span class="line">    ptrGFTT-&gt;<span class="built_in">detect</span>(image, keypoints);</span><br><span class="line">    std::vector&lt;cv::KeyPoint&gt;::const_iterator it = keypoints.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="keyword">while</span>(it != keypoints.<span class="built_in">end</span>())&#123;</span><br><span class="line">        cv::<span class="built_in">circle</span>(image, it-&gt;pt, <span class="number">3</span>, cv::<span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">1</span>);</span><br><span class="line">        ++it;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Mat image;</span><br><span class="line">    image = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/MyCV/data/church01.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Original&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Raw harrisCorner</span></span><br><span class="line">    Mat HarriCornerThreshed;</span><br><span class="line">    HarriCornerThreshed = <span class="built_in">findHarrisCorner</span>(image);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;HarrisCornerThreshed&quot;</span>, HarriCornerThreshed);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// non-maxima suppression(for the problem of feature point clustering.)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create Harris detector instance</span></span><br><span class="line">    Mat image2;</span><br><span class="line">    image.<span class="built_in">copyTo</span>(image2);</span><br><span class="line"></span><br><span class="line">    harrisDetector harris;</span><br><span class="line">    <span class="comment">// Compute Harris values</span></span><br><span class="line">    harris.<span class="built_in">detect</span>(image2);</span><br><span class="line">    <span class="comment">// Detect Harris corners</span></span><br><span class="line">    std::vector&lt;cv::Point&gt; pts;</span><br><span class="line">    harris.<span class="built_in">getCorners</span>(pts, <span class="number">0.02</span>);</span><br><span class="line">    <span class="comment">// Draw Harris corners</span></span><br><span class="line">    harris.<span class="built_in">drawOnImage</span>(image2, pts);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;non-maxima suppression&quot;</span>, image2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  impose a minimum distance between two interest points.</span></span><br><span class="line">    <span class="comment">// (for the problem of feature point clustering.)</span></span><br><span class="line">    Mat image3;</span><br><span class="line">    image.<span class="built_in">copyTo</span>(image3);</span><br><span class="line"></span><br><span class="line">    Mat GfttImage;</span><br><span class="line">    GfttImage = <span class="built_in">MGFTT</span>(image3);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;GFTT&quot;</span>, GfttImage);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://otdfzpvtk.bkt.clouddn.com/Selection_072001.png" alt=""></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Cpp/" rel="tag"># Cpp</a>
              <a href="/tags/OpenCV/" rel="tag"># OpenCV</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/07/09/%E6%88%91%E8%BF%99%E4%B8%AA%E4%BA%BA%E5%91%A2/" rel="prev" title="我这个人呢">
                  <i class="fa fa-chevron-left"></i> 我这个人呢
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/07/22/OpenCV%E8%8E%B7%E5%8F%96%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E6%91%84%E5%83%8F%E5%A4%B4%E7%9A%84%E8%A7%86%E9%A2%91%E6%B5%81/" rel="next" title="OpenCV获取安卓手机摄像头的视频流">
                  OpenCV获取安卓手机摄像头的视频流 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="valine-comments"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mathew Shen</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




<script class="next-config" data-name="valine" type="application/json">{"enable":true,"appId":"qzF75hQvs6yPkMIO7gd7LwDB-gzGzoHsz","appKey":"foULNoeGLTL8LE8C2Ysitv5I","serverURLs":["datahonor.com"],"placeholder":"毕竟今天太阳那么好~(评论时留下邮箱才能收到回复提醒的邮件哦)","avatar":"","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick"],"notify":true,"el":"#valine-comments","path":"/2017/07/20/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%9ADetecting-corners-in-an-image/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.valine.el)
    .then(() => NexT.utils.getScript(
      'https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js',
      { condition: window.Valine }
    ))
    .then(() => {
      new Valine(CONFIG.valine);
    });
});
</script>

</body>
</html>
