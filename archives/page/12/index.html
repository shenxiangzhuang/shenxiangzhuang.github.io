<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"datahonor.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":"ture"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="十年饮冰，难凉热血。">
<meta property="og:type" content="website">
<meta property="og:title" content="DATA HONOR">
<meta property="og:url" content="http://datahonor.com/archives/page/12/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="十年饮冰，难凉热血。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mathew Shen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://datahonor.com/archives/page/12/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"archives/page/12/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>DATA HONOR</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">DATA HONOR</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Pain Is Inevitable; Suffering Is Optional</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mathew Shen"
      src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  <p class="site-author-name" itemprop="name">Mathew Shen</p>
  <div class="site-description" itemprop="description">十年饮冰，难凉热血。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenxiangzhuang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenxiangzhuang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:datahonor@gmail.com" title="E-Mail → mailto:datahonor@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://yuanhang0.github.io/" title="https:&#x2F;&#x2F;yuanhang0.github.io&#x2F;" rel="noopener" target="_blank">Tomorrow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yudaer.github.io/" title="http:&#x2F;&#x2F;yudaer.github.io&#x2F;" rel="noopener" target="_blank">小白二号</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/04/Look-up-tables/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/04/Look-up-tables/" class="post-title-link" itemprop="url">OpenCV系列笔记十四：Look-up tables</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-04 14:25:07" itemprop="dateCreated datePublished" datetime="2017-05-04T14:25:07+08:00">2017-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/04/Look-up-tables/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/04/Look-up-tables/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-28">Overview</h5>
<p>在处理图像的时候，我们可能需要对所有的像素点，根据其像素值的大小，统一进行一个映射的操作，这个时候我们就需要look-up tables来完成这项工作。</p>
<blockquote>
<p>A look-up table is a simple one-to-one (or many-to-one) function that defines how pixel values are transformed into new values. It is a 1D array with, in the case of regular gray-level images, 256 entries.</p>
<p>Entry i of the table gives you the new intensity value of the corresponding gray level, which is expressed as follows:<br>
<code>newIntensity= lookup[oldIntensity];</code></p>
</blockquote>
<h5 id="Code-21">Code</h5>
<h6 id="一般的使用方法">一般的使用方法</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgcodecs.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">getlut</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">lut</span><span class="params">(<span class="number">1</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)&#123;</span><br><span class="line"><span class="comment">//0 becomes 255, 1 becomes 254, etc</span></span><br><span class="line">        lut.<span class="built_in">at</span>&lt;uchar&gt;(i) = <span class="number">255</span>-i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lut;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">getStrechlut</span><span class="params">(cv::Mat image, cv::Mat hist)</span></span>&#123;</span><br><span class="line">    <span class="comment">//number of pixel in percentile</span></span><br><span class="line">    <span class="type">float</span> percentile = <span class="number">0.01</span>;</span><br><span class="line">    <span class="type">float</span> number = image.<span class="built_in">total</span>()*percentile;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> imin = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> count=<span class="number">0.0</span>;imin&lt;<span class="number">256</span>;imin++)&#123;</span><br><span class="line">        <span class="keyword">if</span>((count+=hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(imin)) &gt;= number)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> imax=<span class="number">255</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> count = <span class="number">0.0</span>; imax &gt;= <span class="number">0</span>; imax--)&#123;</span><br><span class="line">        <span class="keyword">if</span>((count+=hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(imax)) &gt;= number)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">cv::Mat <span class="title">lut</span><span class="params">(<span class="number">1</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)&#123;</span><br><span class="line">        lut.<span class="built_in">at</span>&lt;uchar&gt;(i) = <span class="number">255.0</span>*(i-imin)/(imax-imin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lut;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png&quot;</span>,<span class="number">0</span>); <span class="comment">// gray</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line">    <span class="comment">// The histogram object</span></span><br><span class="line">    Histogram1D h;</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Histogram&quot;</span>, h.<span class="built_in">getHistogramImage</span>(image));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Compute the histogram</span></span><br><span class="line">    cv::Mat histo = h.<span class="built_in">getHistogram</span>(image);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//get lut and apply</span></span><br><span class="line">    cv::Mat lut = <span class="built_in">getlut</span>();</span><br><span class="line">    cv::Mat result = h.<span class="built_in">applyLookUp</span>(image, lut);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;inverse lut image&quot;</span>, result);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//get strech lut and apply</span></span><br><span class="line">    cv::Mat strechlut = <span class="built_in">getStrechlut</span>(image, histo);</span><br><span class="line">    cv::Mat strechresult = h.<span class="built_in">applyLookUp</span>(image, strechlut);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;strech lut histo&quot;</span>, h.<span class="built_in">getHistogramImage</span>(strechresult));</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;strech lut image&quot;</span>, strechresult);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170504/Selection_050414%3A18%3A23.png" alt></p>
<h6 id="对之前颜色空间缩减的改进">对之前颜色空间缩减的改进</h6>
<p>之前<a href="http://datahonor.com/2017/04/09/OPenCV-%E5%9B%BE%E7%89%87%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4%E7%BC%A9%E5%87%8F%E4%B8%8E%E9%81%8D%E5%8E%86/">颜色空间缩减</a> 时，我们用了手动遍历的方法进行修改对应的像素值，我们可以用look-up tables进行简化。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgcodecs.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">colorReduce</span><span class="params">(cv::Mat &amp;image, <span class="type">int</span> div=<span class="number">64</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//creating the 1d lookup table</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">lookup</span><span class="params">(<span class="number">1</span>,<span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//defining the color reduction lookup</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)</span><br><span class="line">        lookup.<span class="built_in">at</span>&lt;uchar&gt;(i) = i/div*div+div/<span class="number">2</span>;</span><br><span class="line">    <span class="comment">//lookip table applied on all channels;</span></span><br><span class="line">    cv::<span class="built_in">LUT</span>(image, lookup, image);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用Clone,保护原来图像不受损坏</span></span><br><span class="line">    cv::Mat imageClone = image.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="built_in">colorReduce</span>(imageClone, <span class="number">64</span>);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Result&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Result&quot;</span>, imageClone);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/04/Look-up-tables/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/02/Computing-an-image-histogram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/02/Computing-an-image-histogram/" class="post-title-link" itemprop="url">OpenCV系列笔记十三：Computing an image histogram</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-02 16:34:26" itemprop="dateCreated datePublished" datetime="2017-05-02T16:34:26+08:00">2017-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/02/Computing-an-image-histogram/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/02/Computing-an-image-histogram/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-8">Overview</h4>
<p>我们经常从图像像素点的直方图来获取一些数据，所以绘制直方图也是需要掌握的。</p>
<blockquote>
<p>An image is made of pixels that have different values. For example, in a 1-channel gray-level image, each pixel has an integer value between 0 (black) and 255 (white). Depending on the picture content, you will find different amounts of each gray shade laid out inside the image. A histogram is a simple table that gives you the number of pixels that have a given value in an image (or sometimes, a set of images). The histogram of a gray-level image will, therefore, have 256 entries (or bins). Bin 0 gives you the number of pixels that have the value 0, bin 1 gives you the number of pixels that have the value 1, and so on. Obviously, if you sum all of the entries of a histogram, you should get the total number of pixels. Histograms can also be normalized so that the sum of the bins equals 1. In this case, each bin gives you the percentage of pixels that have this specific value in the image.</p>
</blockquote>
<p>下面我们分别给出单通道[灰度图]和三通道图像直方图的绘制，前者来自这系列笔记的参考书，后者来自官方文档，其实基本思路是一致的。</p>
<h4 id="Code-8">Code</h4>
<h5 id="单通道-灰度图">单通道[灰度图]</h5>
<h6 id="grayhistogram-h">grayhistogram.h</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CLIONS_GRAYHISTOGRAM_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLIONS_GRAYHISTOGRAM_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;highgui.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Histogram1D</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> histSize[<span class="number">1</span>]; <span class="comment">// numbers of bins in histogram</span></span><br><span class="line">    <span class="type">float</span> hranges[<span class="number">2</span>];  <span class="comment">// range of values</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span>* ranges[<span class="number">1</span>];  <span class="comment">// pointer to the value ranges</span></span><br><span class="line">    <span class="type">int</span> channels[<span class="number">1</span>]; <span class="comment">// channel number to be examined</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Histogram1D</span>()&#123;</span><br><span class="line">        <span class="comment">// Prepare default arguments for 1D histogram</span></span><br><span class="line">        histSize[<span class="number">0</span>] = <span class="number">256</span>;  <span class="comment">// 256bins</span></span><br><span class="line">        hranges[<span class="number">0</span>] = <span class="number">0.0</span>;  <span class="comment">// from 0 (inclusive)</span></span><br><span class="line">        hranges[<span class="number">1</span>] = <span class="number">256.0</span>;  <span class="comment">// to 256 (exclusive)</span></span><br><span class="line">        ranges[<span class="number">0</span>] = hranges;</span><br><span class="line">        channels[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// we look at channel 0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setNBins</span><span class="params">(<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">        histSize[<span class="number">0</span>] = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Computes the 1D histogram</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">        cv::Mat hist;</span><br><span class="line">        <span class="comment">//Compute 1D histogram with calcHist</span></span><br><span class="line">        cv::<span class="built_in">calcHist</span>(&amp;image,<span class="number">1</span>,channels,cv::<span class="built_in">Mat</span>(),</span><br><span class="line">                     hist, <span class="number">1</span>, histSize, ranges);</span><br><span class="line">        <span class="keyword">return</span>  hist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Compute the 1D histogram and returns an image of it</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getHistogramImage</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image, <span class="type">int</span> zoom=<span class="number">1</span>)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Compute histogram first</span></span><br><span class="line">        cv::Mat hist = <span class="built_in">getHistogram</span>(image);</span><br><span class="line">        <span class="comment">// Create imaeg</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getImageOfHistogram</span>(hist, zoom);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an image representing a histogram (static method)</span></span><br><span class="line">    <span class="function"><span class="type">static</span> cv::Mat <span class="title">getImageOfHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;hist, <span class="type">int</span> zoom)</span></span>&#123;</span><br><span class="line">        <span class="comment">// Get min and max bin values</span></span><br><span class="line">        <span class="type">double</span> maxVal = <span class="number">0</span>;</span><br><span class="line">        <span class="type">double</span> minVal = <span class="number">0</span>;</span><br><span class="line">        cv::<span class="built_in">minMaxLoc</span>(hist, &amp;minVal, &amp;maxVal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//get histogram size</span></span><br><span class="line">        <span class="type">int</span> histSize = hist.rows;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Square image on which to display histogram</span></span><br><span class="line">        <span class="function">cv::Mat <span class="title">histImg</span><span class="params">(histSize*zoom, histSize*zoom, CV_8U, cv::Scalar(<span class="number">255</span>))</span></span>;</span><br><span class="line">        <span class="comment">// set highest point at 90% of nbins (i.e. image height)</span></span><br><span class="line">        <span class="type">int</span> hpt = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.9</span>*histSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Draw vertical line for each bin</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> h=<span class="number">0</span>; h&lt;histSize; h++)&#123;</span><br><span class="line">            <span class="type">float</span> binVal = hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(h);</span><br><span class="line">            <span class="keyword">if</span>(binVal&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> intensity = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(binVal*hpt/maxVal);</span><br><span class="line">                cv::<span class="built_in">line</span>(histImg, cv::<span class="built_in">Point</span>(h*zoom, histSize*zoom), cv::<span class="built_in">Point</span>(h*zoom, (histSize - intensity)*zoom),cv::<span class="built_in">Scalar</span>(<span class="number">0</span>),zoom);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> histImg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CLIONS_GRAYHISTOGRAM_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="main-cpp-3">main.cpp</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;imageInfo.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/cattle.png&quot;</span>,<span class="number">0</span>); <span class="comment">// gray</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line">    <span class="comment">// The histogram object</span></span><br><span class="line">    Histogram1D h;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Compute the histogram</span></span><br><span class="line">    cv::Mat histo = h.<span class="built_in">getHistogram</span>(image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Loop over each bin</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)&#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;Value &quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot; = &quot;</span></span><br><span class="line">                              &lt;&lt;histo.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i)&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Histogram&quot;</span>, h.<span class="built_in">getHistogramImage</span>(image));</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/02/Computing-an-image-histogram/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/02/Using-colors-for-detection-skin-tone-detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/02/Using-colors-for-detection-skin-tone-detection/" class="post-title-link" itemprop="url">OpenCV系列笔记十二：Using colors for detection - skin tone detection</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-02 12:02:23" itemprop="dateCreated datePublished" datetime="2017-05-02T12:02:23+08:00">2017-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/02/Using-colors-for-detection-skin-tone-detection/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/02/Using-colors-for-detection-skin-tone-detection/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-52">Overview</h5>
<p>关于颜色空间，除了经常用的RGB和之前用于颜色比较的Lab,还有其他很多不同用途的种类。这里我们要检测皮肤，用到的颜色空间是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/HSL%E5%92%8CHSV%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%97%B4">HSV</a>. 原因如下：</p>
<blockquote>
<p>In general, to detect an object using color, you first need to collect a large database of image samples that contain the object captured from different viewing conditions. These will be used to define the parameters of your classifier. You also need to select the color representation that you will use for classification. For skin tone detection, many studies have shown that skin color from the diverse ethnical groups clusters well in the hue/saturation space. For this reason, we will simply use the hue and saturation values to identify the skin tones in the following image.</p>
</blockquote>
<p>显然，在下面的程序里出现的一些阀值也是来自于一些经验数据。</p>
<h5 id="Code-45">Code</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;imageInfo.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">detectHScolor</span><span class="params">(<span class="type">const</span> cv::Mat&amp; image,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">double</span> minHue, <span class="type">double</span> maxHue,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">double</span> minSat, <span class="type">double</span> maxSat,</span></span></span><br><span class="line"><span class="params"><span class="function">                   cv::Mat&amp; mask)</span></span>&#123;</span><br><span class="line">    cv::Mat hsv;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, hsv, CV_BGR2HSV);</span><br><span class="line">    std::vector&lt;cv::Mat&gt;channels;</span><br><span class="line">    cv::<span class="built_in">split</span>(hsv, channels);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hue masking</span></span><br><span class="line">    cv::Mat mask1;</span><br><span class="line">    cv::<span class="built_in">threshold</span>(channels[<span class="number">0</span>], mask1, maxHue, <span class="number">255</span>,cv::THRESH_BINARY_INV);  <span class="comment">// 0~maxhue</span></span><br><span class="line">    cv::Mat mask2;</span><br><span class="line">    cv::<span class="built_in">threshold</span>(channels[<span class="number">0</span>], mask2, minHue, <span class="number">255</span>, cv::THRESH_BINARY);  <span class="comment">// minhue~180</span></span><br><span class="line"></span><br><span class="line">    cv::Mat hueMask;</span><br><span class="line">    <span class="keyword">if</span>(minHue&lt;maxHue)</span><br><span class="line">        hueMask = mask1 &amp; mask2;  <span class="comment">// minhue~maxhue</span></span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// if interval crossed the zero-degrees axis</span></span><br><span class="line">        hueMask = mask1 | mask2;  <span class="comment">// 上面的注释是书上的，一时搞不懂这个else是什么意思...知道的朋友可留言告知...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Saturation masking</span></span><br><span class="line">    <span class="comment">// between minSat and maxSat</span></span><br><span class="line">    cv::Mat satMask;</span><br><span class="line">    cv::<span class="built_in">inRange</span>(channels[<span class="number">1</span>], minSat, maxSat, satMask);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// combined mask</span></span><br><span class="line">    mask = hueMask &amp; satMask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/girl.png&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line">    <span class="comment">//detect skin tone</span></span><br><span class="line">    cv::Mat mask;</span><br><span class="line">    <span class="built_in">detectHScolor</span>(image, <span class="number">160</span>,<span class="number">10</span>,<span class="number">25</span>,<span class="number">166</span>, mask);</span><br><span class="line">    <span class="function">cv::Mat <span class="title">detected</span><span class="params">(image.size(),CV_8UC3,cv::Scalar(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span></span>;</span><br><span class="line">    image.<span class="built_in">copyTo</span>(detected,mask);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Detected&quot;</span>, detected);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170502/Selection_004.png" alt></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/02/Using-colors-for-detection-skin-tone-detection/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/02/Converting-color-reprentations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/02/Converting-color-reprentations/" class="post-title-link" itemprop="url">OpenCV系列笔记十：Converting color reprentations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-02 11:07:38" itemprop="dateCreated datePublished" datetime="2017-05-02T11:07:38+08:00">2017-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/02/Converting-color-reprentations/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/02/Converting-color-reprentations/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-9">Overview</h5>
<p>在第九篇中，我们通过计算颜色范围来提取出ROI（上例为蓝天部分），我们是在BGR颜色空间进行的，但是在这个颜色空间并不是很好。原因是：</p>
<blockquote>
<p>Unfortunately, computing the distance between the colors using the<br>
RGB color space is not the best way to measure the similarity between<br>
two given colors. Indeed, RGB is not a perceptually uniform color<br>
space. This means that two colors at a given distance might look very<br>
similar, while two other colors separated by the same distance might<br>
look very different.</p>
</blockquote>
<p>所以：</p>
<blockquote>
<p>To solve this problem, other color representations that have the property<br>
of being perceptually uniform have been introduced. In particular, the<br>
CIE L<em>a</em>b* is one such color model. By converting our images to this<br>
representation, the Euclidean distance between an image pixel and the<br>
target color will then be a meaningful measure of the visual similarity<br>
between the two colors.</p>
</blockquote>
<h5 id="Code-9">Code</h5>
<p>这里核心的程序就是转换到另一个颜色空间进行颜色比较和颜色范围的界定。</p>
<p>主要改动就是process这里：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">ColorDetector::process</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">    <span class="comment">// re-allocate binary map if necessary</span></span><br><span class="line">    <span class="comment">// same size as input image, but 1-channel</span></span><br><span class="line">    result.<span class="built_in">create</span>(image.<span class="built_in">size</span>(), CV_8U);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Converting to Lab color space</span></span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, converted, CV_BGR2Lab);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// processing</span></span><br><span class="line">    <span class="comment">// get the iterators</span></span><br><span class="line">    cv::Mat_&lt;cv::Vec3b&gt;::const_iterator it = converted.<span class="built_in">begin</span>&lt;cv::Vec3b&gt;();</span><br><span class="line">    cv::Mat_&lt;cv::Vec3b&gt;::const_iterator itend = converted.<span class="built_in">end</span>&lt;cv::Vec3b&gt;();</span><br><span class="line">    cv::Mat_&lt;uchar&gt;::iterator itout = result.<span class="built_in">begin</span>&lt;uchar&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for each pixel</span></span><br><span class="line">    <span class="keyword">for</span>(; it!=itend;++it, ++itout)&#123;</span><br><span class="line">        <span class="comment">// compute distance from target color</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">getColorDitanceToTargetColor</span>(*it) &lt;= maxDist)&#123;</span><br><span class="line">            *itout = <span class="number">255</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            *itout = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>为了方便运行，这里也贴下完整的代码：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/02/Converting-color-reprentations/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/02/Segmenting-an-image-with-the-GrabCut-algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/02/Segmenting-an-image-with-the-GrabCut-algorithm/" class="post-title-link" itemprop="url">OpenCV系列笔记十一：Segmenting an image with the GrabCut algorithm</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-02 09:40:33" itemprop="dateCreated datePublished" datetime="2017-05-02T09:40:33+08:00">2017-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/02/Segmenting-an-image-with-the-GrabCut-algorithm/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/02/Segmenting-an-image-with-the-GrabCut-algorithm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-48">Overview</h5>
<p>如上篇所述，所关注的物体有较为独特的颜色时，我们可以通过一个颜色范围过滤出想要的物体。但是有些时候所要抽取的物体并不总是有鲜明的颜色特征。这里，我们介绍另一种根据图片特征进行分类的算法，即为GrabCut.</p>
<h5 id="Code-42">Code</h5>
<p>先看一下实现代码和效果：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;imageInfo.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line">    <span class="function">cv::Rect <span class="title">rectangle</span><span class="params">(<span class="number">50</span>,<span class="number">30</span>,<span class="number">240</span>,<span class="number">170</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// show the ractangle</span></span><br><span class="line">    cv::Mat imageclone = image.<span class="built_in">clone</span>();</span><br><span class="line">    cv::<span class="built_in">rectangle</span>(imageclone, rectangle, <span class="number">255</span>, <span class="number">2</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Image with Ractangle&quot;</span>, imageclone);</span><br><span class="line"></span><br><span class="line">    cv::Mat result;</span><br><span class="line">    cv::Mat bgMOdel, fgModel;</span><br><span class="line">    cv::<span class="built_in">grabCut</span>(image, result, rectangle, bgMOdel, fgModel, <span class="number">5</span>, cv::GC_INIT_WITH_RECT);</span><br><span class="line"></span><br><span class="line"><span class="comment">//    打印可以看到result是由1，2，3，4组成，即为四种模式</span></span><br><span class="line"><span class="comment">//    std::cout&lt;&lt;result&lt;&lt;std::endl;</span></span><br><span class="line"><span class="comment">//    std::cout&lt;&lt;cv::GC_PR_FGD&lt;&lt;std::endl;</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">compare</span>(result, cv::GC_PR_FGD, result, cv::CMP_EQ);</span><br><span class="line">    <span class="function">cv::Mat <span class="title">foreground</span><span class="params">(image.size(), CV_8UC3,cv::Scalar(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span></span>;</span><br><span class="line">    image.<span class="built_in">copyTo</span>(foreground, result);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;foreground&quot;</span>, foreground);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170502/Selection_002.png" alt></p>
<p>简单解释下上面的程序：</p>
<ul>
<li>[ ] <strong>cv::grubCut</strong><br>
先看下文档的参数解释：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170502/Selection_001.png" alt></li>
</ul>
<blockquote>
<p>中文解释，参考<a target="_blank" rel="noopener" href="http://blog.csdn.net/zouxy09/article/details/8535087">这里</a><br>
这个解释还是挺不错的，但是在mask和rect这里好像和文档有些出入。第一个是mask这里，即使不手工标记，也会有GCD_BGD存在，因为rect之外的部分默认被视为背景，我们上面的实验结果result也是未进行人工标注，其包含0，2，3.</p>
</blockquote>
<ul>
<li>[ ] <strong>models</strong><br>
看文档强调在处理同一张图片时，不要修改两个models,即bgdModel和fgdModel.这是因为运行grubCut之后，里面保存了一些之前迭代的数据，如果得到的结果不理想，我们可以再次利用这两个models继续迭代，省去重复迭代。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/02/Segmenting-an-image-with-the-GrabCut-algorithm/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B9%9D%EF%BC%9AComparing-colors-using-the-Strategy-design-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B9%9D%EF%BC%9AComparing-colors-using-the-Strategy-design-pattern/" class="post-title-link" itemprop="url">OpenCV系列笔记九：Comparing colors using the Strategy design pattern</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-28 13:20:46" itemprop="dateCreated datePublished" datetime="2017-04-28T13:20:46+08:00">2017-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B9%9D%EF%BC%9AComparing-colors-using-the-Strategy-design-pattern/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B9%9D%EF%BC%9AComparing-colors-using-the-Strategy-design-pattern/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-34">Overview</h5>
<p>介绍通过比较颜色来检测一片区域，并进行处理的方法，采用了Strategy design pattern.</p>
<blockquote>
<p>Let’s say we want to build a simple algorithm that will identify all of the<br>
pixels in an image that have a given color. For this, the algorithm has to<br>
accept an image and a color as input and will return a binary image<br>
showing the pixels that have the specified color. The tolerance with<br>
which we want to accept a color will be another parameter to be<br>
specified before running the algorithm.</p>
</blockquote>
<h5 id="Code-27">Code</h5>
<p>代码通过两种方式来进行颜色的比较， 一种是自己实现的，另一种是应用了OpenCV提供的函数absdiff等。最后将这种算法的效果和floodfill进行比较。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Comparing colors using the Strategy design pattern</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ColorDetector</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// minimun accptable distance</span></span><br><span class="line">    <span class="type">int</span> maxDist;</span><br><span class="line">    <span class="comment">// target color</span></span><br><span class="line">    cv::Vec3b target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// image containing resulting binary map</span></span><br><span class="line">    cv::Mat result;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// empty constructor</span></span><br><span class="line">    <span class="comment">// default parameter initialization here</span></span><br><span class="line">    <span class="built_in">ColorDetector</span>():<span class="built_in">maxDist</span>(<span class="number">50</span>),<span class="built_in">target</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// full constructor with target and distance</span></span><br><span class="line">    <span class="comment">// functor</span></span><br><span class="line">    <span class="built_in">ColorDetector</span>(uchar blue, uchar green, uchar red, <span class="type">int</span> maxDist=<span class="number">50</span>):</span><br><span class="line">            <span class="built_in">maxDist</span>(maxDist)&#123;</span><br><span class="line">        <span class="built_in">setTargetColor</span>(blue, green, red);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// functor--&gt; ()</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">process_bycv</span>(image);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sets the color distance threshold</span></span><br><span class="line">    <span class="comment">// Threshold must be positive,</span></span><br><span class="line">    <span class="comment">// otherwise distance threshold is set to 0.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setColorDistanceThreshold</span><span class="params">(<span class="type">int</span> distance)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(distance&lt;<span class="number">0</span>)</span><br><span class="line">            distance = <span class="number">0</span>;</span><br><span class="line">        maxDist = distance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Gets the color distance threshold</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getColorDistanceThreshold</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxDist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sets the color to be detected</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTargetColor</span><span class="params">(uchar blue, uchar green, uchar red)</span></span>&#123;</span><br><span class="line">        <span class="comment">// BGR order</span></span><br><span class="line">        target = cv::<span class="built_in">Vec3b</span>(blue, green, red);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sets the color to be detected</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTargetColor</span><span class="params">(cv::Vec3b color)</span></span>&#123;</span><br><span class="line">        target = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Gets the color to be detected</span></span><br><span class="line">    <span class="function">cv::Vec3b <span class="title">getTargetColor</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// process the image</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">process</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">process_bycv</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getColorDitanceToTargetColor</span><span class="params">(<span class="type">const</span> cv::Vec3b&amp; color)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getColorDistance</span>(color, target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Compute the city-block distance between two colors</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getColorDistance</span><span class="params">(<span class="type">const</span> cv::Vec3b&amp;color1, <span class="type">const</span> cv::Vec3b&amp; color2)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(color1[<span class="number">0</span>]-color2[<span class="number">0</span>]+</span><br><span class="line">                   <span class="built_in">abs</span>(color1[<span class="number">1</span>])-color2[<span class="number">1</span>]+</span><br><span class="line">                   <span class="built_in">abs</span>(color1[<span class="number">2</span>]-color2[<span class="number">2</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">ColorDetector::process</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span></span>&#123;</span><br><span class="line">    <span class="comment">// re-allocate binary map if necessary</span></span><br><span class="line">    <span class="comment">// same size as input image, but 1-channel</span></span><br><span class="line">    result.<span class="built_in">create</span>(image.<span class="built_in">size</span>(), CV_8U);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// processing</span></span><br><span class="line">    <span class="comment">// get the iterators</span></span><br><span class="line">    cv::Mat_&lt;cv::Vec3b&gt;::const_iterator it = image.<span class="built_in">begin</span>&lt;cv::Vec3b&gt;();</span><br><span class="line">    cv::Mat_&lt;cv::Vec3b&gt;::const_iterator itend = image.<span class="built_in">end</span>&lt;cv::Vec3b&gt;();</span><br><span class="line">    cv::Mat_&lt;uchar&gt;::iterator itout = result.<span class="built_in">begin</span>&lt;uchar&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for each pixel</span></span><br><span class="line">    <span class="keyword">for</span>(; it!=itend;++it, ++itout)&#123;</span><br><span class="line">        <span class="comment">// compute distance from target color</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">getColorDitanceToTargetColor</span>(*it) &lt;= maxDist)&#123;</span><br><span class="line">            *itout = <span class="number">255</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            *itout = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">ColorDetector::process_bycv</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span> </span>&#123;</span><br><span class="line">    cv::Mat output;</span><br><span class="line">    <span class="comment">// compute abssolute difference with tarfet color</span></span><br><span class="line">    cv::<span class="built_in">absdiff</span>(image, cv::<span class="built_in">Scalar</span>(target) ,output);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//split the channels into 3 images;</span></span><br><span class="line">    std::vector&lt;cv::Mat&gt; images;</span><br><span class="line">    cv::<span class="built_in">split</span>(output, images);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add the 3 channels (saturation might occurs here)</span></span><br><span class="line">    output = images[<span class="number">0</span>] + images[<span class="number">1</span>] + images[<span class="number">2</span>];</span><br><span class="line">    <span class="comment">// apply threshold</span></span><br><span class="line">    cv::<span class="built_in">threshold</span>(output, output, maxDist, <span class="number">255</span>, cv::THRESH_BINARY_INV);</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1. Create image processor object</span></span><br><span class="line">    ColorDetector cdetect;</span><br><span class="line">    <span class="comment">//2. Read input image</span></span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(image.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. Set input parameters</span></span><br><span class="line">    cdetect.<span class="built_in">setTargetColor</span>(<span class="number">230</span>, <span class="number">190</span>, <span class="number">130</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. Process the image and display the result</span></span><br><span class="line">    cv::Mat result1 = cdetect.<span class="built_in">process</span>(image);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;process&quot;</span>, result1);</span><br><span class="line"></span><br><span class="line">    cv::Mat result2 = cdetect.<span class="built_in">process_bycv</span>(image);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;process_bycv&quot;</span>, result2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// another way</span></span><br><span class="line">    <span class="function">ColorDetector <span class="title">colordetector</span><span class="params">(<span class="number">230</span>, <span class="number">190</span>, <span class="number">130</span>)</span></span>;</span><br><span class="line">    cv::Mat result = <span class="built_in">colordetector</span>(image);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;colordetector result&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// show the result in original image</span></span><br><span class="line">    cv::Mat image_masked, mask_inv;</span><br><span class="line">    mask_inv = <span class="number">255</span> - result;</span><br><span class="line">    cv::<span class="built_in">bitwise_and</span>(image, image, image_masked, mask_inv);</span><br><span class="line">    cv::<span class="built_in">add</span>(image_masked, cv::<span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), image_masked, result);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image_masked&quot;</span>, image_masked);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//floodFill的用法</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">floodFill</span>(image, cv::<span class="built_in">Point</span>(<span class="number">100</span>,<span class="number">50</span>),cv::<span class="built_in">Scalar</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>),</span><br><span class="line">                  (cv::Rect*)<span class="number">0</span>, cv::<span class="built_in">Scalar</span>(<span class="number">35</span>,<span class="number">35</span>,<span class="number">35</span>), cv::<span class="built_in">Scalar</span>(<span class="number">35</span>,<span class="number">35</span>,<span class="number">35</span>),</span><br><span class="line">                  cv::FLOODFILL_FIXED_RANGE);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Flood fill&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170427/9.png" alt></p>
<p>关于floodfill和原算法的不同之处：</p>
<blockquote>
<p>Our ColorDetector class identifies the pixels in an image that have a<br>
color similar to a given target color. The decision to accept or not a pixel<br>
is simply made on a per-pixel basis. The cv::floodFill function<br>
proceeds in a very similar way with one important difference: in this<br>
case, the decision to accept a pixel also depends on the state of its<br>
neighbors. The idea is to identify a connected area of a certain color.<br>
The user specifies a starting pixel location and tolerance parameters that<br>
determine color similarity.</p>
</blockquote>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B9%9D%EF%BC%9AComparing-colors-using-the-Strategy-design-pattern/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%85%AB%EF%BC%9ARemapping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%85%AB%EF%BC%9ARemapping/" class="post-title-link" itemprop="url">OpenCV系列笔记八：Remapping</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-28 11:29:15" itemprop="dateCreated datePublished" datetime="2017-04-28T11:29:15+08:00">2017-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%85%AB%EF%BC%9ARemapping/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%85%AB%EF%BC%9ARemapping/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-40">Overview</h5>
<p>关于Remapping, <a target="_blank" rel="noopener" href="http://docs.opencv.org/2.4/doc/tutorials/imgproc/imgtrans/remap/remap.html">官方文档</a>已经解释的十分清楚了。</p>
<blockquote>
<p>It is the process of taking pixels from one place in the image and locating them in another position in a new image.</p>
<p>To accomplish the mapping process, it might be necessary to do some interpolation for non-integer pixel locations, since there will not always be a one-to-one-pixel correspondence between source and destination images.</p>
<p>We can express the remap for every pixel location (x,y) as:<br>
<code>g(x,y) = f ( h(x,y) )</code><br>
where g() is the remapped image, f() the source image and h(x,y) is the mapping function that operates on (x,y)</p>
</blockquote>
<p>注意这里对函数的理解，也就是remapping的过程，举个简单的例子，当remapping函数为h(x,y)=(x+1, y+1)时， 新的图像g(3,4) = f(h(3, 4)) = f(4, 5), 也就是说新得到的图像(3,4)处的像素点原来是在原图像的(4, 5)处。</p>
<h5 id="Code-33">Code</h5>
<p>这里是书上的一段代码，很简短，官方文档给的例子比较好些。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;imageInfo.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// remapping an image by createing wave effects</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">wave</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image, cv::Mat &amp;result)</span></span>&#123;</span><br><span class="line">    <span class="comment">//the mao function</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">srcX</span><span class="params">(image.rows, image.cols, CV_32F)</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">srcY</span><span class="params">(image.rows, image.cols, CV_32F)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// creating the mapping</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image.rows; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image.cols; j++) &#123;</span><br><span class="line">            <span class="comment">// new location of pixel at (i, j)</span></span><br><span class="line">            srcX.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i,j)=j;</span><br><span class="line">            srcY.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i,j) = i+<span class="number">5</span>*<span class="built_in">sin</span>(j/<span class="number">10.0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// applying the mapping</span></span><br><span class="line">    cv::<span class="built_in">remap</span>(image,result, srcX, srcY,cv::INTER_LINEAR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image1 = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line">    <span class="built_in">getImageInfo</span>(image1);</span><br><span class="line">    cv::Mat result;</span><br><span class="line">    <span class="built_in">wave</span>(image1, result);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170427/7.png" alt></p>
<h5 id="Reference-11">Reference</h5>
<p><a target="_blank" rel="noopener" href="http://docs.opencv.org/2.4/doc/tutorials/imgproc/imgtrans/remap/remap.html">Remapping</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%85%AB%EF%BC%9ARemapping/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%83%EF%BC%9ANeighbor-access/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%83%EF%BC%9ANeighbor-access/" class="post-title-link" itemprop="url">OpenCV系列笔记七：Neighbor access</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-28 09:48:42" itemprop="dateCreated datePublished" datetime="2017-04-28T09:48:42+08:00">2017-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%83%EF%BC%9ANeighbor-access/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%83%EF%BC%9ANeighbor-access/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-33">Overview</h5>
<p>前面介绍了几种获取特定位置像素点的方法，但是有些时候我们也需要同时获取其周围的像素点的值，这时候，我们仿照前面的做法，只需要多加上几个位置指针即可。</p>
<h5 id="Code-26">Code</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sharpen</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image, cv::Mat &amp;result)</span></span>&#123;</span><br><span class="line">    <span class="comment">// allocate if necessary</span></span><br><span class="line">    result.<span class="built_in">create</span>(image.<span class="built_in">size</span>(), image.<span class="built_in">type</span>());</span><br><span class="line">    <span class="type">int</span> nchannels = image.<span class="built_in">channels</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for all rows(except first and last</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image.rows - <span class="number">1</span>; j++) &#123;</span><br><span class="line">        <span class="type">const</span> uchar * previous = image.<span class="built_in">ptr</span>&lt;<span class="type">const</span> uchar&gt;(j<span class="number">-1</span>);</span><br><span class="line">        <span class="type">const</span> uchar * current = image.<span class="built_in">ptr</span>&lt;<span class="type">const</span> uchar&gt;(j);</span><br><span class="line">        <span class="type">const</span> uchar * next = image.<span class="built_in">ptr</span>&lt;<span class="type">const</span> uchar&gt;(j+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        uchar* output = result.<span class="built_in">ptr</span>&lt;uchar&gt;(j); <span class="comment">// output row</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=nchannels; i&lt;(image.cols<span class="number">-1</span>)*nchannels; i++)&#123;</span><br><span class="line">            <span class="comment">// apply sharpening operator</span></span><br><span class="line">            *output++ = cv::<span class="built_in">saturate_cast</span>&lt;uchar&gt;(</span><br><span class="line">                    <span class="number">5</span>*current[i]-current[i-nchannels]-</span><br><span class="line">                    current[i+nchannels]-previous[i]-next[i]</span><br><span class="line">                        );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// set the unprocessed pixels to 0</span></span><br><span class="line">    result.<span class="built_in">row</span>(<span class="number">0</span>).<span class="built_in">setTo</span>(cv::<span class="built_in">Scalar</span>(<span class="number">0</span>));</span><br><span class="line">    result.<span class="built_in">row</span>(result.rows<span class="number">-1</span>).<span class="built_in">setTo</span>(cv::<span class="built_in">Scalar</span>(<span class="number">0</span>));</span><br><span class="line">    result.<span class="built_in">col</span>(<span class="number">0</span>).<span class="built_in">setTo</span>(cv::<span class="built_in">Scalar</span>(<span class="number">0</span>));</span><br><span class="line">    result.<span class="built_in">col</span>(result.cols<span class="number">-1</span>).<span class="built_in">setTo</span>(cv::<span class="built_in">Scalar</span>(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sharpen2D</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image, cv::Mat &amp;result)</span></span>&#123;</span><br><span class="line">    <span class="comment">// Construct kernel (all entries initialized to 0)</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">kernel</span><span class="params">(<span class="number">3</span>,<span class="number">3</span>, CV_32F, cv::Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="comment">//assigns kernel values</span></span><br><span class="line">    kernel.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>,<span class="number">1</span>) = <span class="number">5.0</span>;</span><br><span class="line">    kernel.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>,<span class="number">1</span>) = <span class="number">-1.0</span>;</span><br><span class="line">    kernel.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">2</span>,<span class="number">1</span>) = <span class="number">-1.0</span>;</span><br><span class="line">    kernel.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>,<span class="number">0</span>) = <span class="number">-1.0</span>;</span><br><span class="line">    kernel.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span>,<span class="number">2</span>) = <span class="number">-1.0</span>;</span><br><span class="line">    <span class="comment">//filter the image</span></span><br><span class="line">    cv::<span class="built_in">filter2D</span>(image, result, image.<span class="built_in">depth</span>(), kernel);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::Mat result1, result2;</span><br><span class="line">    <span class="built_in">sharpen</span>(image, result1);</span><br><span class="line">    <span class="built_in">sharpen2D</span>(image, result2);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Result1&quot;</span>, result1);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Result2&quot;</span>, result2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170427/8.png" alt></p>
<p>几点补充：</p>
<ul>
<li>[ ] cv::saturate_cast<uchar></uchar></li>
</ul>
<blockquote>
<p>其作用是保证像素点操作过程中出现的低于0或者大于255的值强制转化为0和255.</p>
</blockquote>
<ul>
<li>[ ] 彩色图像的操作</li>
</ul>
<blockquote>
<p>在对彩色图像进行处理的时候，每次对单个pixel的单个channel操作。</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%83%EF%BC%9ANeighbor-access/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/04/28/Accessing-pixel-values/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/28/Accessing-pixel-values/" class="post-title-link" itemprop="url">OpenCV系列笔记五：Accessing pixel values</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-28 08:24:51" itemprop="dateCreated datePublished" datetime="2017-04-28T08:24:51+08:00">2017-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/04/28/Accessing-pixel-values/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/04/28/Accessing-pixel-values/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-2">Overview</h5>
<p>图片本就是由一个一个的像素点组成，我们有时候需要对一些特殊的像素点就行操作，而操作像素点的第一个问题就是如何获取到这些像素点。OpenCV为我们提供了at方法。</p>
<h5 id="Code-2">Code</h5>
<h6 id="Mat">Mat</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">salt</span><span class="params">(cv::Mat image, <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">// C++11 random number generator</span></span><br><span class="line">    std::default_random_engine generator;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt;</span></span><br><span class="line"><span class="function">            <span class="title">randomRow</span><span class="params">(<span class="number">0</span>, image.rows <span class="number">-1</span>)</span></span>;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt;</span></span><br><span class="line"><span class="function">            <span class="title">randomCol</span><span class="params">(<span class="number">0</span>, image.cols <span class="number">-1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>; k&lt;n; k++)&#123;</span><br><span class="line">        <span class="comment">// random image coordinate</span></span><br><span class="line">        i = <span class="built_in">randomCol</span>(generator);</span><br><span class="line">        j = <span class="built_in">randomRow</span>(generator);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(image.<span class="built_in">type</span>() == CV_8UC1)&#123;</span><br><span class="line">            <span class="comment">// gray image, single-channel 8-bit image</span></span><br><span class="line">            image.<span class="built_in">at</span>&lt;uchar&gt;(j,i) = <span class="number">255</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (image.<span class="built_in">type</span>() == CV_8UC3)&#123;</span><br><span class="line">            <span class="comment">// color image, 3-channel image</span></span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j,i)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j,i)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j,i)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">            <span class="comment">// or in this way</span></span><br><span class="line">            <span class="comment">//image.at&lt;cv::Vec3b&gt;(j,i) = cv::Vec3b(255,255,255);</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line">    <span class="built_in">salt</span>(image, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Image&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Image&quot;</span>, image);</span><br><span class="line">    cv::<span class="built_in">imwrite</span>(<span class="string">&quot;salt-lake.jpg&quot;</span>, image);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170427/3.png" alt></p>
<h6 id="Mat-2">Mat_</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// for color image</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">salt</span><span class="params">(cv::Mat_&lt;cv::Vec3b&gt; image, <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">// C++11 random number generator</span></span><br><span class="line">    std::default_random_engine generator;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt;</span></span><br><span class="line"><span class="function">            <span class="title">randomRow</span><span class="params">(<span class="number">0</span>, image.rows <span class="number">-1</span>)</span></span>;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt;</span></span><br><span class="line"><span class="function">            <span class="title">randomCol</span><span class="params">(<span class="number">0</span>, image.cols <span class="number">-1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>; k&lt;n; k++)&#123;</span><br><span class="line">        <span class="comment">// random image coordinate</span></span><br><span class="line">        i = <span class="built_in">randomCol</span>(generator);</span><br><span class="line">        j = <span class="built_in">randomRow</span>(generator);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// color image, 3-channel image</span></span><br><span class="line">        <span class="built_in">image</span>(j,i)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">        <span class="built_in">image</span>(j,i)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">        <span class="built_in">image</span>(j,i)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">        <span class="comment">// or in this way</span></span><br><span class="line">        <span class="comment">//image(j,i) = cv::Vec3b(255,255,255);</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// overload for gray image</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">salt</span><span class="params">(cv::Mat_&lt;uchar&gt; image, <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">// C++11 random number generator</span></span><br><span class="line">    std::default_random_engine generator;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt;</span></span><br><span class="line"><span class="function">            <span class="title">randomRow</span><span class="params">(<span class="number">0</span>, image.rows <span class="number">-1</span>)</span></span>;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt;</span></span><br><span class="line"><span class="function">            <span class="title">randomCol</span><span class="params">(<span class="number">0</span>, image.cols <span class="number">-1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>; k&lt;n; k++)&#123;</span><br><span class="line">        <span class="comment">// random image coordinate</span></span><br><span class="line">        i = <span class="built_in">randomCol</span>(generator);</span><br><span class="line">        j = <span class="built_in">randomRow</span>(generator);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// gray image, single-channel 8-bit image</span></span><br><span class="line">        <span class="built_in">image</span>(j,i) = <span class="number">255</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// color</span></span><br><span class="line">    cv::Mat_&lt;cv::Vec3b&gt; image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/lake.png&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">salt</span>(image, <span class="number">3000</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Salted Image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// gray</span></span><br><span class="line">    cv::Mat_&lt;uchar&gt; gray;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, gray, cv::COLOR_BGR2GRAY);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Gray&quot;</span>, gray);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">salt</span>(gray, <span class="number">3000</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Salted Gray&quot;</span>, gray);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/28/Accessing-pixel-values/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%9B%9B%EF%BC%9AROI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%9B%9B%EF%BC%9AROI/" class="post-title-link" itemprop="url">OpenCV系列笔记四：ROI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-28 00:00:24" itemprop="dateCreated datePublished" datetime="2017-04-28T00:00:24+08:00">2017-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%9B%9B%EF%BC%9AROI/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%9B%9B%EF%BC%9AROI/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-41">Overview</h5>
<p>在对图片进行处理的时候，我们关注的往往是图片的某些区域，称为regions of interest，即为ROI。我们的操作也是主要针对这些区域进行的。来看下面这个向图片上添加logo的例子。</p>
<h5 id="Code-34">Code</h5>
<p>我们直接将logo加到图片上去，即使使用权重，效果也是不好。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image, logo;</span><br><span class="line">    image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/bao.jpeg&quot;</span>);</span><br><span class="line">    logo = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/logo.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;logo&quot;</span>, logo);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">    <span class="comment">// define image ROI at image bottom-right</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">imageROI</span><span class="params">(image, cv::Rect(<span class="number">0</span>,<span class="number">0</span>, logo.cols, logo.rows))</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  insert logo directly</span></span><br><span class="line">    logo.<span class="built_in">copyTo</span>(imageROI);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;add drictly&quot;</span>, image);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  add in weight</span></span><br><span class="line">    cv::Mat dst;</span><br><span class="line">    cv::<span class="built_in">addWeighted</span>(imageROI, <span class="number">0.7</span>, logo, <span class="number">0.3</span>, <span class="number">0</span>,imageROI);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;add in weight&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170427/1.png" alt></p>
<p>这里，我们应当专注于ROI的mask使用，用来提取logo的主体和ROI的背景。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image, logo;</span><br><span class="line">    image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/bao.jpeg&quot;</span>);</span><br><span class="line">    logo = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/logo.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;logo&quot;</span>, logo);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">    <span class="comment">// define image ROI at image bottom-right</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">imageROI</span><span class="params">(image, cv::Rect(<span class="number">0</span>,<span class="number">0</span>, logo.cols, logo.rows))</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::Mat logo_gray;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(logo, logo_gray, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    cv::Mat mask, mask_inv;</span><br><span class="line">    <span class="comment">//下面将logo主体形状[灰度值不再100-255的部分]标记为白色255，即在按位和时取此白色部分</span></span><br><span class="line">    cv::<span class="built_in">threshold</span>(logo_gray, mask, <span class="number">100</span>, <span class="number">255</span>, CV_THRESH_BINARY_INV);</span><br><span class="line">    <span class="comment">// mask_inv与mask颜色相反[黑白互换即0,255互换]，即在取按位和时取logo的背景部分</span></span><br><span class="line">    cv::<span class="built_in">bitwise_not</span>(mask,mask_inv);</span><br><span class="line"></span><br><span class="line">    cv::Mat img_bg, logo_fg;</span><br><span class="line">    <span class="comment">//取出ROI中和背景部分重合的区域，预留主体部分为黑色0</span></span><br><span class="line">    cv::<span class="built_in">bitwise_and</span>(imageROI,imageROI, img_bg, mask_inv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从logo中取出logo主体部分，预留非logo主体部分为黑色0</span></span><br><span class="line">    cv::<span class="built_in">bitwise_and</span>(logo,logo,logo_fg,mask);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 相加合并图像</span></span><br><span class="line">    cv::<span class="built_in">add</span>(img_bg, logo_fg,imageROI);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理过程中产生的图像</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;mask&quot;</span>, mask);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;img_bg&quot;</span>, img_bg);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;logo_fg&quot;</span>, logo_fg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//最后完成合并的图像</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170427/2.png" alt></p>
<p>这段代码对初学者理解起来可能有些困难，我也是反复看了几次才搞懂…主要的流程就是，先将logo转化为灰度图，再进行threshold操作，用mask分离出logo主体，再通过mask作用于logo的按位和得到logo主体部分，其余背景为0（黑色）；同样地，再将mask_inv作用于原图片的ROI区域的按位和，得到ROI区域的背景，其中预留将要和logo主体重合的部分为0（黑色）。这样，再直接将抠出来的背景和logo相加，就得到看了想要的效果了。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%9B%9B%EF%BC%9AROI/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/archives/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/archives/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/18/">18</a><a class="extend next" rel="next" href="/archives/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mathew Shen</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




<script class="next-config" data-name="valine" type="application/json">{"enable":true,"appId":"qzF75hQvs6yPkMIO7gd7LwDB-gzGzoHsz","appKey":"foULNoeGLTL8LE8C2Ysitv5I","serverURLs":["datahonor.com"],"placeholder":"毕竟今天太阳那么好~(评论时留下邮箱才能收到回复提醒的邮件哦)","avatar":"","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick"],"notify":true,"el":"#valine-comments","path":"/archives/page/12/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.valine.el)
    .then(() => NexT.utils.getScript(
      'https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js',
      { condition: window.Valine }
    ))
    .then(() => {
      new Valine(CONFIG.valine);
    });
});
</script>

</body>
</html>
