<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"datahonor.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":"ture"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="十年饮冰，难凉热血。">
<meta property="og:type" content="website">
<meta property="og:title" content="DATA HONOR">
<meta property="og:url" content="http://datahonor.com/archives/page/11/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="十年饮冰，难凉热血。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mathew Shen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://datahonor.com/archives/page/11/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"archives/page/11/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>DATA HONOR</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">DATA HONOR</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Pain Is Inevitable; Suffering Is Optional</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mathew Shen"
      src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  <p class="site-author-name" itemprop="name">Mathew Shen</p>
  <div class="site-description" itemprop="description">十年饮冰，难凉热血。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenxiangzhuang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenxiangzhuang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:datahonor@gmail.com" title="E-Mail → mailto:datahonor@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://yuanhang0.github.io/" title="https:&#x2F;&#x2F;yuanhang0.github.io&#x2F;" rel="noopener" target="_blank">Tomorrow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yudaer.github.io/" title="http:&#x2F;&#x2F;yudaer.github.io&#x2F;" rel="noopener" target="_blank">小白二号</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/15/Morphalogical-Operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/15/Morphalogical-Operations/" class="post-title-link" itemprop="url">OpenCV系列笔记十九：Morphalogical Operations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-15 22:59:20" itemprop="dateCreated datePublished" datetime="2017-05-15T22:59:20+08:00">2017-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/15/Morphalogical-Operations/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/15/Morphalogical-Operations/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-30">Overview</h4>
<p>一些图像的形态学操作，主要包括Erosion, Dilation, Closing 和 Opening.</p>
<p>它们之间有一些巧妙的关系：</p>
<p>Erosion and Dilation:</p>
<blockquote>
<p>The erosion of an image is equivalent to the complement of the<br>
dilation of the complement image<br>
The dilation of an image is equivalent to the complement of the<br>
erosion of the complement image</p>
</blockquote>
<p>Closing and Opening:</p>
<blockquote>
<p>The opening and closing filters are simply defined in terms of the basic<br>
erosion and dilation operations. Closing is defined as the erosion of the<br>
dilation of an image. Opening is defined as the dilation of the erosion of<br>
an image.</p>
</blockquote>
<p>最后注意下Idempotent：</p>
<blockquote>
<p>Note that applying the same opening (and similarly the closing) operator on an image several times has no effect. Indeed, as the holes have been filled by the first opening filter, an additional application of the same filter will not produce any other changes to the image. In mathematical terms, these operators are said to be idempotent.</p>
</blockquote>
<p>对这些概念的理解可以参考Youtube的一套视频，讲的挺好(自备梯子:-)：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/15/Morphalogical-Operations/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/15/OpenCV%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98-YAML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/15/OpenCV%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98-YAML/" class="post-title-link" itemprop="url">OpenCV计算结果保存--YAML/XML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-15 22:42:16" itemprop="dateCreated datePublished" datetime="2017-05-15T22:42:16+08:00">2017-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/15/OpenCV%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98-YAML/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/15/OpenCV%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98-YAML/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在图像的操作与识别等过程中，我们很多时候要保存一些计算结果，方便后续的使用。OpenCV为我们提供了XML/YAML持久化层来完成这个任务。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入操作</span></span><br><span class="line">    <span class="function">FileStorage <span class="title">fs</span><span class="params">(<span class="string">&quot;Test.yml&quot;</span>, FileStorage::WRITE)</span></span>;</span><br><span class="line">    <span class="comment">// save as int</span></span><br><span class="line">    <span class="type">int</span> fps = <span class="number">5</span>;</span><br><span class="line">    fs&lt;&lt;<span class="string">&quot;fps&quot;</span>&lt;&lt;fps;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mat</span></span><br><span class="line">    Mat m1 = Mat::<span class="built_in">eye</span>(<span class="number">2</span>, <span class="number">3</span>, CV_32F);</span><br><span class="line">    Mat m2 = Mat::<span class="built_in">ones</span>(<span class="number">3</span>, <span class="number">2</span>, CV_32F);</span><br><span class="line">    Mat result = (m1+<span class="number">1</span>).<span class="built_in">mul</span>(m1+<span class="number">3</span>);</span><br><span class="line">    fs&lt;&lt;<span class="string">&quot;Result&quot;</span>&lt;&lt;result;</span><br><span class="line"></span><br><span class="line">    fs.<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取操作</span></span><br><span class="line">    <span class="function">FileStorage <span class="title">fs_r</span><span class="params">(<span class="string">&quot;Test.yml&quot;</span>, FileStorage::READ)</span></span>;</span><br><span class="line"></span><br><span class="line">    Mat r;</span><br><span class="line">    fs_r[<span class="string">&quot;Result&quot;</span>] &gt;&gt; r;</span><br><span class="line">    std::cout&lt;&lt; r&lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    fs_r.<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>[8, 3, 3;<br>
3, 8, 3]</p>
</blockquote>
<p>此时，查看Test.YML文件：</p>
<pre><code>%YAML:1.0
---
fps: 5
Result: !!opencv-matrix
   rows: 2
   cols: 3
   dt: f
   data: [ 8., 3., 3., 3., 8., 3. ]
</code></pre>
<p>同样地，我们将上面文件的拓展名改为.xml，再次运行我们可以得到Test.xml文件：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;opencv_storage&gt;
&lt;fps&gt;5&lt;/fps&gt;
&lt;Result type_id=&quot;opencv-matrix&quot;&gt;
  &lt;rows&gt;2&lt;/rows&gt;
  &lt;cols&gt;3&lt;/cols&gt;
  &lt;dt&gt;f&lt;/dt&gt;
  &lt;data&gt;
    8. 3. 3. 3. 8. 3.&lt;/data&gt;&lt;/Result&gt;
&lt;/opencv_storage&gt;
</code></pre>
<p>参考：<em>OpenCV By Example</em></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/15/OpenCV%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98-YAML/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/15/Visual-tracking-using-histograms/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/15/Visual-tracking-using-histograms/" class="post-title-link" itemprop="url">OpenCV系列笔记十八：Visual tracking using histograms</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-15 16:56:09" itemprop="dateCreated datePublished" datetime="2017-05-15T16:56:09+08:00">2017-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/15/Visual-tracking-using-histograms/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/15/Visual-tracking-using-histograms/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-54">Overview</h4>
<p>在之前，我们介绍了Intergral Image， 还有通过mean shift算法搜索物体。这里，来学习下利用Intergral Image，通过比较histogram来追踪物体。</p>
<p>代码里面比较难理解的就是先将灰度图转化为多通道二进制图的部分。关于这里我也迷惑好久，再次仔细读书，其实书上已经写的比较清楚了：</p>
<blockquote>
<p>The cv::integral function also works for multichannel images. You can take advantage of this fact to compute histograms of image subregions using integral images. You simply need to convert your image into a multichannel image made of binary planes; each of these planes is associated to a bin of your histogram and shows you which pixels have a value that falls into this bin.</p>
</blockquote>
<h4 id="Code-47">Code</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;grayhistogram.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;integral.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Open image</span></span><br><span class="line">    cv::Mat image= cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/bike55.bmp&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// define image roi</span></span><br><span class="line">    <span class="type">int</span> xo=<span class="number">97</span>, yo=<span class="number">112</span>;</span><br><span class="line">    <span class="type">int</span> width=<span class="number">25</span>, height=<span class="number">30</span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">roi</span><span class="params">(image,cv::Rect(xo,yo,width,height))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// compute sum</span></span><br><span class="line">    <span class="comment">// returns a Scalar to work with multi-channel images</span></span><br><span class="line">    cv::Scalar sum= cv::<span class="built_in">sum</span>(roi);</span><br><span class="line">    std::cout &lt;&lt; sum[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// compute integral image</span></span><br><span class="line">    cv::Mat integralImage;</span><br><span class="line">    cv::<span class="built_in">integral</span>(image,integralImage,CV_32S);</span><br><span class="line">    <span class="comment">// get sum over an area using three additions/subtractions</span></span><br><span class="line">    <span class="type">int</span> sumInt= integralImage.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(yo+height,xo+width)</span><br><span class="line">                -integralImage.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(yo+height,xo)</span><br><span class="line">                -integralImage.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(yo,xo+width)</span><br><span class="line">                +integralImage.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(yo,xo);</span><br><span class="line">    std::cout &lt;&lt; sumInt &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// histogram of 16 bins</span></span><br><span class="line">    Histogram1D h;</span><br><span class="line">    h.<span class="built_in">setNBins</span>(<span class="number">16</span>);</span><br><span class="line">    <span class="comment">// compute histogram over image roi</span></span><br><span class="line">    cv::Mat refHistogram= h.<span class="built_in">getHistogram</span>(roi);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Reference Histogram&quot;</span>,h.<span class="built_in">getHistogramImage</span>(roi,<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// first create 16-plane binary image</span></span><br><span class="line">    cv::Mat planes;</span><br><span class="line">    <span class="built_in">convertToBinaryPlanes</span>(image,planes,<span class="number">16</span>);</span><br><span class="line">    <span class="comment">// then compute integral image</span></span><br><span class="line">    <span class="function">IntegralImage&lt;<span class="type">float</span>,16&gt; <span class="title">intHisto</span><span class="params">(planes)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// for testing compute a histogram of 16 bins with integral image</span></span><br><span class="line">    cv::Vec&lt;<span class="type">float</span>,<span class="number">16</span>&gt; histogram= <span class="built_in">intHisto</span>(xo,yo,width,height);</span><br><span class="line"><span class="comment">//    std::cout&lt;&lt;&quot; integral image histogram &quot;&lt;&lt; histogram &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line">    cv::Mat im= h.<span class="built_in">getImageOfHistogram</span>(cv::<span class="built_in">Mat</span>(histogram),<span class="number">16</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;IM&quot;</span>, im);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// search in second image</span></span><br><span class="line">    cv::Mat secondImage= cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/bike65.bmp&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (!secondImage.data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// first create 16-plane binary image</span></span><br><span class="line">    <span class="built_in">convertToBinaryPlanes</span>(secondImage,planes,<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then compute integral image</span></span><br><span class="line">    <span class="function">IntegralImage&lt;<span class="type">float</span>,16&gt; <span class="title">intHistogram</span><span class="params">(planes)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// compute histogram of 16 bins with integral image (testing)</span></span><br><span class="line">    histogram= <span class="built_in">intHistogram</span>(<span class="number">135</span>,<span class="number">114</span>,width,height);</span><br><span class="line"></span><br><span class="line">    cv::Mat im2= h.<span class="built_in">getImageOfHistogram</span>(cv::<span class="built_in">Mat</span>(histogram),<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Distance= &quot;</span> &lt;&lt; cv::<span class="built_in">compareHist</span>(refHistogram,histogram, cv::HISTCMP_INTERSECT) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> maxSimilarity=<span class="number">0.0</span>;</span><br><span class="line">    <span class="type">int</span> xbest, ybest;</span><br><span class="line">    <span class="comment">// loop over a horizontal strip around girl location in initial image</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y=<span class="number">110</span>; y&lt;<span class="number">120</span>; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x=<span class="number">0</span>; x&lt;secondImage.cols-width; x++) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// compute histogram of 16 bins using integral image</span></span><br><span class="line">            histogram= <span class="built_in">intHistogram</span>(x,y,width,height);</span><br><span class="line">            <span class="comment">// compute distance with reference histogram</span></span><br><span class="line">            <span class="type">double</span> distance= cv::<span class="built_in">compareHist</span>(refHistogram,histogram, cv::HISTCMP_INTERSECT);</span><br><span class="line">            <span class="comment">// find position of most similar histogram</span></span><br><span class="line">            <span class="keyword">if</span> (distance&gt;maxSimilarity) &#123;</span><br><span class="line"></span><br><span class="line">                xbest= x;</span><br><span class="line">                ybest= y;</span><br><span class="line">                maxSimilarity= distance;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Distance(&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;)=&quot;</span> &lt;&lt; distance &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Best solution= (&quot;</span> &lt;&lt; xbest &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; ybest &lt;&lt; <span class="string">&quot;)=&quot;</span> &lt;&lt; maxSimilarity &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw a rectangle around target object</span></span><br><span class="line">    cv::<span class="built_in">rectangle</span>(image,cv::<span class="built_in">Rect</span>(xo,yo,width,height),<span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Initial Image&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Initial Image&quot;</span>,image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;New Image&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;New Image&quot;</span>,secondImage);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw rectangle at best location</span></span><br><span class="line">    cv::<span class="built_in">rectangle</span>(secondImage,cv::<span class="built_in">Rect</span>(xbest,ybest,width,height),<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// draw rectangle around search area</span></span><br><span class="line">    cv::<span class="built_in">rectangle</span>(secondImage,cv::<span class="built_in">Rect</span>(<span class="number">0</span>,<span class="number">110</span>,secondImage.cols,height+<span class="number">10</span>),<span class="number">255</span>);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Object location&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Object location&quot;</span>,secondImage);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170515/Selection_051501.png" alt></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/15/Visual-tracking-using-histograms/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/15/Adaptive-thresholding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/15/Adaptive-thresholding/" class="post-title-link" itemprop="url">OpenCV系列笔记十七：Adaptive thresholding</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-15 08:15:28" itemprop="dateCreated datePublished" datetime="2017-05-15T08:15:28+08:00">2017-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/15/Adaptive-thresholding/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/15/Adaptive-thresholding/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-3">Overview</h4>
<p>在介绍Adaptive thresholding之前，让我们来看看Integral Image的概念：</p>
<blockquote>
<p>Integral images have been introduced as an efficient way of summing<br>
pixels in image regions of interest. They are widely used in applications<br>
that involve, for example, computations over sliding windows at multiple<br>
scales.</p>
</blockquote>
<p>可以看到，Integral Image是避免重复计算多个ROI像素值和的一种方法。接下来，我们实现的就是简单的矩形ROI，使得Integral Image上的每一个点的值为：该点和图像左上角形成的矩形区域像素值之和。</p>
<p>而Adaptive thresholding 是相对于fixed thresholding而言的。fixed就是我们之前常用的固定阀值，而Adaptive的阀值是由一个固定阀值和一个变化的均值决定的，这个均值，就是某像素点周围一些像素点的均值。</p>
<h4 id="Code-3">Code</h4>
<h5 id="integral-h">integral.h</h5>
<p>实际上，OpenCV已经提供了计算Integral Image的函数<code>cv::integral</code>，但是书上也自己实现了一边，我们这里也贴上。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !defined IINTEGRAL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IINTEGRAL</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="type">int</span> N&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IntegralImage</span> &#123;</span><br><span class="line"></span><br><span class="line">      cv::Mat integralImage;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">      <span class="built_in">IntegralImage</span>(cv::Mat image) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (costly) computation of the integral image</span></span><br><span class="line">        cv::<span class="built_in">integral</span>(image,integralImage,cv::DataType&lt;T&gt;::type);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// compute sum over sub-regions of any size from 4 pixel access</span></span><br><span class="line">      <span class="function">cv::Vec&lt;T,N&gt; <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> xo, <span class="type">int</span> yo, <span class="type">int</span> width, <span class="type">int</span> height)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// window at (xo,yo) of size width by height</span></span><br><span class="line">          <span class="keyword">return</span> (integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(yo+height,xo+width)</span><br><span class="line">                  -integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(yo+height,xo)</span><br><span class="line">                  -integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(yo,xo+width)</span><br><span class="line">                  +integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(yo,xo));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// compute sum over sub-regions of any size from 4 pixel access</span></span><br><span class="line">      <span class="function">cv::Vec&lt;T,N&gt; <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> radius)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// square window centered at (x,y) of size 2*radius+1</span></span><br><span class="line">          <span class="keyword">return</span> (integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(y+radius+<span class="number">1</span>,x+radius+<span class="number">1</span>)</span><br><span class="line">                  -integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(y+radius+<span class="number">1</span>,x-radius)</span><br><span class="line">                  -integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(y-radius,x+radius+<span class="number">1</span>)</span><br><span class="line">                  +integralImage.at&lt;cv::Vec&lt;T,N&gt; &gt;(y-radius,x-radius));</span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert to a multi-channel image made of binary planes</span></span><br><span class="line"><span class="comment">// nPlanes must be a power of 2</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">convertToBinaryPlanes</span><span class="params">(<span class="type">const</span> cv::Mat&amp; input, cv::Mat&amp; output, <span class="type">int</span> nPlanes)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// number of bits to mask out</span></span><br><span class="line">        <span class="type">int</span> n= <span class="number">8</span>-<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">log</span>(<span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(nPlanes))/<span class="built_in">log</span>(<span class="number">2.0</span>));</span><br><span class="line">        <span class="comment">// mask used to eliminate least significant bits</span></span><br><span class="line">        uchar mask= <span class="number">0xFF</span>&lt;&lt;n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// create a vector of 16 binary images</span></span><br><span class="line">        std::vector&lt;cv::Mat&gt; planes;</span><br><span class="line">        <span class="comment">// reduce to nBins bins by eliminating least significant bits</span></span><br><span class="line">        cv::Mat reduced= input&amp;mask;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// compute each binary image plane</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;nPlanes; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1 for each pixel equals to i&lt;&lt;shift</span></span><br><span class="line">            planes.<span class="built_in">push_back</span>((reduced==(i&lt;&lt;n))&amp;<span class="number">0x1</span>);  <span class="comment">// i&lt;&lt;n  --&gt; 16, 32, 48, ...</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create multi-channel image</span></span><br><span class="line">        cv::<span class="built_in">merge</span>(planes,output);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="main-cpp">main.cpp</h5>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/15/Adaptive-thresholding/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/11/Queue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/11/Queue/" class="post-title-link" itemprop="url">Queue</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-11 00:23:24" itemprop="dateCreated datePublished" datetime="2017-05-11T00:23:24+08:00">2017-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/11/Queue/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/11/Queue/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-46">Overview</h4>
<p>前面学习的栈是后进先出[LIFO]，与之相对的是队列的先进先出[FIFO]。这里我们通过两种方式实现Queue,分别是Array和List。在Array实现的时候要注意，实际上，整个过程都是在一维的数组上操作的，但是，为了在enqueue[插入]和dequeue[弹出]数据的时候有效地利用空间，我们将其看作一个圆环，这样，前面dequeue留下的空间，还可以共之后enqueue使用。</p>
<h4 id="Code-41">Code</h4>
<h5 id="Array实现–genArrayQueue-h">Array实现–genArrayQueue.h</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by shensir on 17-5-10.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CPPPROJECTS_GENARRAYQUEUE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CPPPROJECTS_GENARRAYQUEUE_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">int</span> size=<span class="number">100</span>&gt;</span><br><span class="line"><span class="keyword">class</span> ArrayQueue&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> first, last;</span><br><span class="line">    T storage[size];</span><br><span class="line">    <span class="type">int</span> total_num=<span class="number">0</span>;  <span class="comment">// 用于计数，方便打印</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ArrayQueue</span>()&#123;</span><br><span class="line">        first = last = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enqueue</span><span class="params">(T)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dequeue</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isFull</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> first==<span class="number">0</span> &amp;&amp; last==size<span class="number">-1</span> || first == last+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> first == <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 由于dequeue只是移动首部的位置，并不是真正的删除，所以打印的时候不能直接循环打印</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = first; i &lt; total_num+first; i++) &#123;</span><br><span class="line">            std::cout&lt;&lt;storage[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">int</span> size&gt;</span><br><span class="line"><span class="type">void</span> ArrayQueue&lt;T,size&gt;::<span class="built_in">enqueue</span>(T el) &#123;</span><br><span class="line">    total_num += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isFull</span>())&#123;</span><br><span class="line">        <span class="keyword">if</span>(last==size<span class="number">-1</span> || last == <span class="number">-1</span>)&#123;</span><br><span class="line">            storage[<span class="number">0</span>] = el;</span><br><span class="line">            last = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(first == <span class="number">-1</span>)</span><br><span class="line">                first = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> storage[++last] = el;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> std::cout&lt;&lt;<span class="string">&quot;Full queue.\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">int</span> size&gt;</span><br><span class="line">T ArrayQueue&lt;T, size&gt;::<span class="built_in">dequeue</span>() &#123;</span><br><span class="line">    total_num -= <span class="number">1</span>;</span><br><span class="line">    T tmp;</span><br><span class="line">    tmp = storage[first];</span><br><span class="line">    <span class="keyword">if</span>(first == last)</span><br><span class="line">        last = first = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(first == size<span class="number">-1</span>)</span><br><span class="line">        first = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> first++;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CPPPROJECTS_GENARRAYQUEUE_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="main-cpp-9">main.cpp</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;genArrayQueue.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ArrayQueue&lt;<span class="type">int</span>&gt; AQ;</span><br><span class="line">    AQ.<span class="built_in">enqueue</span>(<span class="number">2</span>);</span><br><span class="line">    AQ.<span class="built_in">enqueue</span>(<span class="number">3</span>);</span><br><span class="line">    AQ.<span class="built_in">enqueue</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    AQ.<span class="built_in">dequeue</span>();</span><br><span class="line"></span><br><span class="line">    AQ.<span class="built_in">printQueue</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>3 4</p>
</blockquote>
<h5 id="List实现–genQueue-h">List实现–genQueue.h</h5>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/11/Queue/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/10/Stacks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/10/Stacks/" class="post-title-link" itemprop="url">Stacks</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-10 22:40:17" itemprop="dateCreated datePublished" datetime="2017-05-10T22:40:17+08:00">2017-05-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/10/Stacks/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/10/Stacks/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-49">Overview</h4>
<p>继前面单双链表之后，再来学习下Stacks.教材还是参考<em>Data Structure and Algorithms in c++</em>。下面是普通栈的实现和list在栈的应用。最后，实现了书中提到的大数的相加算法。</p>
<h4 id="Code-43">Code</h4>
<h5 id="Stacks">Stacks</h5>
<h6 id="genStack-h">genStack.h</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by shensir on 17-5-10.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CPPPROJECTS_GENSTACK_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CPPPROJECTS_GENSTACK_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">int</span> capacity=<span class="number">30</span>&gt;</span><br><span class="line"><span class="keyword">class</span> Stack&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;T&gt;pool;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Stack</span>()&#123;</span><br><span class="line">        pool.<span class="built_in">reserve</span>(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        pool.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !pool.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T&amp; <span class="title">topEl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pool.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(pool.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            T el = pool.<span class="built_in">back</span>();</span><br><span class="line">            pool.<span class="built_in">pop_back</span>();</span><br><span class="line">            <span class="keyword">return</span> el;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">const</span> T&amp; el)</span></span>&#123;</span><br><span class="line">        pool.<span class="built_in">push_back</span>(el);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印stack</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printstack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Stack: \n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">typename</span> std::vector&lt;T&gt;::iterator i = pool.<span class="built_in">end</span>()<span class="number">-1</span>; i != pool.<span class="built_in">begin</span>()<span class="number">-1</span>; i--)&#123;</span><br><span class="line">            std::cout&lt;&lt;*i&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取stack长度</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getsize</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pool.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CPPPROJECTS_GENSTACK_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="main-cpp-13">main.cpp</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;genStack.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Stack&lt;<span class="type">int</span>&gt;S;</span><br><span class="line">    S.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    S.<span class="built_in">push</span>(<span class="number">2</span>);</span><br><span class="line">    S.<span class="built_in">push</span>(<span class="number">3</span>);</span><br><span class="line">    S.<span class="built_in">printstack</span>();</span><br><span class="line"></span><br><span class="line">    S.<span class="built_in">pop</span>();</span><br><span class="line">    S.<span class="built_in">printstack</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>Stack:<br>
3<br>
2<br>
1<br>
Stack:<br>
2<br>
1</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/10/Stacks/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/08/About-if-name-main-in-Python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/08/About-if-name-main-in-Python/" class="post-title-link" itemprop="url">About if __name__=='__main__' in Python</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-08 18:02:48" itemprop="dateCreated datePublished" datetime="2017-05-08T18:02:48+08:00">2017-05-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/08/About-if-name-main-in-Python/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/08/About-if-name-main-in-Python/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview">Overview</h5>
<p>关于<code>if __name__ == '__main__'</code>,一直想写个笔记，但是老忘，这里总结下。</p>
<p>总的来说，这句代码的作用是<strong>既能保证当前的py文件直接运行，也能保证其可以作为模块被其他py文件导入</strong>。</p>
<p>怎么理解这句话呢？我们通过几个小例子来看下。</p>
<h5 id="Code">Code</h5>
<h6 id="name">__name__</h6>
<p>首先任意创建一个py文件，仅输入一行代码</p>
<p><code>print(__name__)</code></p>
<p>然后运行，输出：</p>
<blockquote>
<p><strong>main</strong></p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/08/About-if-name-main-in-Python/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/06/Octave-IN-Ubuntu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/06/Octave-IN-Ubuntu/" class="post-title-link" itemprop="url">Octave in Ubuntu</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-06 23:10:53" itemprop="dateCreated datePublished" datetime="2017-05-06T23:10:53+08:00">2017-05-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/06/Octave-IN-Ubuntu/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/06/Octave-IN-Ubuntu/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于Ubuntu16.04LTS下Octave的安装和使用。</p>
<h5 id="安装-3">安装</h5>
<blockquote>
<p>sudo add-apt-repository ppa:octave/stable<br>
sudo apt-get update<br>
sudo apt-get install octave</p>
</blockquote>
<p>参考<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/645600/how-to-install-octave-4-0-0-in-ubuntu-14-04">这里</a></p>
<p>之后运行报错：</p>
<blockquote>
<p>The settings file /home/user/.config/octave/qt-settings does not exist and can not be created.<br>
Make sure you have read and write permissions to /home/user/.config/octave Octave GUI must be closed now.</p>
</blockquote>
<p>解决办法：</p>
<blockquote>
<p>cd .config/octave<br>
sudo chown user qt-settings</p>
</blockquote>
<p>其中user改为自己的用户名。chown为更改拥有者的命令。</p>
<p>参考<a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/292721/error-running-octave-in-ubuntu-16-04">这里</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/06/Octave-IN-Ubuntu/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/04/Using-the-mean-shift-algorithm-to-find-an-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/04/Using-the-mean-shift-algorithm-to-find-an-object/" class="post-title-link" itemprop="url">OpenCV系列笔记十六：Using the mean shift algorithm to find an object</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-04 15:40:36" itemprop="dateCreated datePublished" datetime="2017-05-04T15:40:36+08:00">2017-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/04/Using-the-mean-shift-algorithm-to-find-an-object/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/04/Using-the-mean-shift-algorithm-to-find-an-object/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-53">Overview</h5>
<p>在上一篇笔记<a href="http://datahonor.com/2017/05/04/Backprojecting-a-histogram-to/">OpenCV系列笔记十五：Backprojecting a histogram to detect specific image content </a>，我们了解了histogram backprojection的原理及用法。这里，我们在backprojection的基础上介绍一种新的算法，即mean shift。他用来在给定的模糊范围，精确定位一个已知histogram[从给定的ROI得到]的物体。来看下参考书的介绍：</p>
<blockquote>
<p>The result of a histogram backprojection is a probability map that expresses the probability that a given piece of image content is found at a specific image location. Suppose we now know the approximate location of an object in an image; the probability map can be used to find the exact location of the object. The most probable location will be the one that maximizes this probability inside a given window. Therefore, if we start from an initial location and iteratively move around in an attempt to increase the local probability measure, it should be possible to find the exact object location. This is what is accomplished by the <strong>mean shift algorithm</strong>.</p>
</blockquote>
<p>在看下文档对mean shift的介绍：</p>
<pre><code>/** @brief Finds an object on a back projection image.

@param probImage Back projection of the object histogram. See calcBackProject for details.
@param window Initial search window.
@param criteria Stop criteria for the iterative search algorithm.
returns
:   Number of iterations CAMSHIFT took to converge.
The function implements the iterative object search algorithm. It takes the input back projection of
an object and the initial position. The mass center in window of the back projection image is
computed and the search window center shifts to the mass center. The procedure is repeated until the
specified number of iterations criteria.maxCount is done or until the window center shifts by less
than criteria.epsilon. The algorithm is used inside CamShift and, unlike CamShift , the search
window size or orientation do not change during the search. You can simply pass the output of
calcBackProject to this function. But better results can be obtained if you pre-filter the back
projection and remove the noise. For example, you can do this by retrieving connected components
with findContours , throwing away contours with small area ( contourArea ), and rendering the
remaining contours with drawContours.

@note
-   A mean-shift tracking sample can be found at opencv_source_code/samples/cpp/camshiftdemo.cpp
 */
CV_EXPORTS_W int meanShift( InputArray probImage, CV_IN_OUT Rect&amp; window, TermCriteria criteria );
</code></pre>
<p>mean shift算法是根据已经生成的backprojection map，在给定的初始位置开始进行迭代搜索，直到前后centroid差值小于给定的阀值或者达到预先设定的最大迭代次数时停止迭代, 函数返回达到收敛时迭代的次数。</p>
<h5 id="Code-46">Code</h5>
<p>[colorhistogram.h和contentfinder.h在前一篇笔记已经给出]</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;colorhistogram.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;contentfinder.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Read reference image</span></span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/baboon01.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">// initial window position</span></span><br><span class="line">    <span class="function">cv::Rect <span class="title">rect</span><span class="params">(<span class="number">110</span>, <span class="number">45</span>, <span class="number">35</span>, <span class="number">45</span>)</span></span>;</span><br><span class="line">    cv::<span class="built_in">rectangle</span>(image, rect, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">    <span class="comment">// Baboon&#x27;s face ROI</span></span><br><span class="line">    cv::Mat imageROI = <span class="built_in">image</span>(rect);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Image1&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Image1&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the Hue histogram of baboon&#x27;s face</span></span><br><span class="line">    <span class="type">int</span> minSat = <span class="number">65</span>;</span><br><span class="line">    ColorHistogram hc;</span><br><span class="line">    cv::Mat colorhist = hc.<span class="built_in">getHueHistogram</span>(imageROI, minSat);</span><br><span class="line"></span><br><span class="line">    ContentFinder finder;</span><br><span class="line">    finder.<span class="built_in">setHistogram</span>(colorhist);</span><br><span class="line"></span><br><span class="line">    image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/baboon02.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert to HSV space</span></span><br><span class="line">    cv::Mat hsv;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, hsv, CV_BGR2HSV);</span><br><span class="line">    <span class="comment">// Get back-projection of hue histogram</span></span><br><span class="line">    <span class="type">int</span> ch[<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    finder.<span class="built_in">setThreshold</span>(<span class="number">-1.0f</span>); <span class="comment">// no thresholding</span></span><br><span class="line">    cv::Mat result = finder.<span class="built_in">find</span>(hsv, <span class="number">0.0f</span>, <span class="number">180.0f</span>, ch);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initial window position</span></span><br><span class="line">    cv::<span class="built_in">rectangle</span>(image, rect, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line"></span><br><span class="line">    cv::Rect* prect = &amp;rect;</span><br><span class="line">    <span class="comment">// Search object with mean shift</span></span><br><span class="line">    <span class="function">cv::TermCriteria <span class="title">criteria</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            cv::TermCriteria::MAX_ITER | cv::TermCriteria::EPS,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="number">10</span>, <span class="comment">// iterate max 10 times</span></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="number">1</span>)</span></span>; <span class="comment">// or until the change in centroid position is less than 1px</span></span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;meanshif= &quot;</span>&lt;&lt;cv::<span class="built_in">meanShift</span>(result, *prect, criteria)&lt;&lt;std::endl;</span><br><span class="line">    cv::<span class="built_in">rectangle</span>(image, *prect , cv::<span class="built_in">Scalar</span>(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;image 2&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image 2&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170504/Selection_050415%3A35%3A28.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/04/Using-the-mean-shift-algorithm-to-find-an-object/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/04/Backprojecting-a-histogram-to/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/04/Backprojecting-a-histogram-to/" class="post-title-link" itemprop="url">OpenCV系列笔记十五：Backprojecting a histogram to detect specific image content</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-04 15:06:11" itemprop="dateCreated datePublished" datetime="2017-05-04T15:06:11+08:00">2017-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/04/Backprojecting-a-histogram-to/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/04/Backprojecting-a-histogram-to/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="Overview-6">Overview</h5>
<p>之前，我们在 <a href="http://datahonor.com/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B9%9D%EF%BC%9AComparing-colors-using-the-Strategy-design-pattern/">OpenCV系列笔记九：Comparing colors using the Strategy design pattern</a><br>
, 和<a href="http://datahonor.com/2017/05/02/Using-colors-for-detection-skin-tone-detection/">OpenCV系列笔记十二：Using colors for detection - skin tone detection</a>里面分别介绍了在不同的颜色空间下，通过计算颜色距离，来进行the detection of specific image content.这里，我们将要介绍的histogram backprojection是一种新的进行detection的方法。</p>
<blockquote>
<p>A histogram is an important characteristic of an image’s content. If you look at an image area that shows a particular texture or a particular object, then the histogram of this area can be seen as a function that gives the probability that a given pixel belongs to this specific texture or object.</p>
</blockquote>
<p>简单讲就是说，我们通过指定一块具有代表性的区域，来检测图片中具有相同特征的所有区域。而检测的根据就是直方图，根据直方图的相似度来进行判别。</p>
<h5 id="Code-5">Code</h5>
<h6 id="colorhistogram-h">colorhistogram.h</h6>
<p>可以看到这里面很多函数在此处是用不到的，但是还是贴出来，好进一步的学习。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CLIONS_COLORHISTOGRAM_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLIONS_COLORHISTOGRAM_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ColorHistogram</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> histSize[<span class="number">3</span>];        <span class="comment">// size of each dimension</span></span><br><span class="line">    <span class="type">float</span> hranges[<span class="number">2</span>];       <span class="comment">// range of values (same for the 3 dimensions)</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span>* ranges[<span class="number">3</span>]; <span class="comment">// array of ranges for each dimension</span></span><br><span class="line">    <span class="type">int</span> channels[<span class="number">3</span>];        <span class="comment">// channel to be considered</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ColorHistogram</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare default arguments for a color histogram</span></span><br><span class="line">        <span class="comment">// each dimension has equal size and range</span></span><br><span class="line">        histSize[<span class="number">0</span>]= histSize[<span class="number">1</span>]= histSize[<span class="number">2</span>]= <span class="number">256</span>;</span><br><span class="line">        hranges[<span class="number">0</span>]= <span class="number">0.0</span>;    <span class="comment">// BRG range from 0 to 256</span></span><br><span class="line">        hranges[<span class="number">1</span>]= <span class="number">256.0</span>;</span><br><span class="line">        ranges[<span class="number">0</span>]= hranges; <span class="comment">// in this class,</span></span><br><span class="line">        ranges[<span class="number">1</span>]= hranges; <span class="comment">// all channels have the same range</span></span><br><span class="line">        ranges[<span class="number">2</span>]= hranges;</span><br><span class="line">        channels[<span class="number">0</span>]= <span class="number">0</span>;		<span class="comment">// the three channels: B</span></span><br><span class="line">        channels[<span class="number">1</span>]= <span class="number">1</span>;     <span class="comment">// G</span></span><br><span class="line">        channels[<span class="number">2</span>]= <span class="number">2</span>;     <span class="comment">// R</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set histogram size for each dimension</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSize</span><span class="params">(<span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// each dimension has equal size</span></span><br><span class="line">        histSize[<span class="number">0</span>]= histSize[<span class="number">1</span>]= histSize[<span class="number">2</span>]= size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Computes the histogram.</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        cv::Mat hist;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// BGR color histogram</span></span><br><span class="line">        hranges[<span class="number">0</span>]= <span class="number">0.0</span>;    <span class="comment">// BRG range</span></span><br><span class="line">        hranges[<span class="number">1</span>]= <span class="number">256.0</span>;</span><br><span class="line">        channels[<span class="number">0</span>]= <span class="number">0</span>;		<span class="comment">// the three channels</span></span><br><span class="line">        channels[<span class="number">1</span>]= <span class="number">1</span>;</span><br><span class="line">        channels[<span class="number">2</span>]= <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compute histogram</span></span><br><span class="line">        cv::<span class="built_in">calcHist</span>(&amp;image,</span><br><span class="line">            <span class="number">1</span>,			<span class="comment">// histogram of 1 image only</span></span><br><span class="line">            channels,	<span class="comment">// the channel used</span></span><br><span class="line">            cv::<span class="built_in">Mat</span>(),	<span class="comment">// no mask is used</span></span><br><span class="line">            hist,		<span class="comment">// the resulting histogram</span></span><br><span class="line">            <span class="number">3</span>,			<span class="comment">// it is a 3D histogram</span></span><br><span class="line">            histSize,	<span class="comment">// number of bins</span></span><br><span class="line">            ranges		<span class="comment">// pixel value range</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Computes the histogram.</span></span><br><span class="line">    <span class="function">cv::SparseMat <span class="title">getSparseHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">cv::SparseMat <span class="title">hist</span><span class="params">(<span class="number">3</span>,        <span class="comment">// number of dimensions</span></span></span></span><br><span class="line"><span class="params"><span class="function">                           histSize, <span class="comment">// size of each dimension</span></span></span></span><br><span class="line"><span class="params"><span class="function">                           CV_32F)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// BGR color histogram</span></span><br><span class="line">        hranges[<span class="number">0</span>]= <span class="number">0.0</span>;    <span class="comment">// BRG range</span></span><br><span class="line">        hranges[<span class="number">1</span>]= <span class="number">256.0</span>;</span><br><span class="line">        channels[<span class="number">0</span>]= <span class="number">0</span>;		<span class="comment">// the three channels</span></span><br><span class="line">        channels[<span class="number">1</span>]= <span class="number">1</span>;</span><br><span class="line">        channels[<span class="number">2</span>]= <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compute histogram</span></span><br><span class="line">        cv::<span class="built_in">calcHist</span>(&amp;image,</span><br><span class="line">            <span class="number">1</span>,			<span class="comment">// histogram of 1 image only</span></span><br><span class="line">            channels,	<span class="comment">// the channel used</span></span><br><span class="line">            cv::<span class="built_in">Mat</span>(),	<span class="comment">// no mask is used</span></span><br><span class="line">            hist,		<span class="comment">// the resulting histogram</span></span><br><span class="line">            <span class="number">3</span>,			<span class="comment">// it is a 3D histogram</span></span><br><span class="line">            histSize,	<span class="comment">// number of bins</span></span><br><span class="line">            ranges		<span class="comment">// pixel value range</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Computes the 1D Hue histogram.</span></span><br><span class="line">    <span class="comment">// BGR source image is converted to HSV</span></span><br><span class="line">    <span class="comment">// Pixels with low saturation are ignored</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getHueHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="type">int</span> minSaturation=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        cv::Mat hist;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Convert to HSV colour space</span></span><br><span class="line">        cv::Mat hsv;</span><br><span class="line">        cv::<span class="built_in">cvtColor</span>(image, hsv, CV_BGR2HSV);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Mask to be used (or not)</span></span><br><span class="line">        cv::Mat mask;</span><br><span class="line">        <span class="comment">// creating the mask if required</span></span><br><span class="line">        <span class="keyword">if</span> (minSaturation&gt;<span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Spliting the 3 channels into 3 images</span></span><br><span class="line">            std::vector&lt;cv::Mat&gt; v;</span><br><span class="line">            cv::<span class="built_in">split</span>(hsv,v);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Mask out the low saturated pixels</span></span><br><span class="line">            cv::<span class="built_in">threshold</span>(v[<span class="number">1</span>],mask,minSaturation,<span class="number">255</span>,</span><br><span class="line">                                 cv::THRESH_BINARY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare arguments for a 1D hue histogram</span></span><br><span class="line">        hranges[<span class="number">0</span>]= <span class="number">0.0</span>;    <span class="comment">// range is from 0 to 180</span></span><br><span class="line">        hranges[<span class="number">1</span>]= <span class="number">180.0</span>;</span><br><span class="line">        channels[<span class="number">0</span>]= <span class="number">0</span>;    <span class="comment">// the hue channel</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compute histogram</span></span><br><span class="line">        cv::<span class="built_in">calcHist</span>(&amp;hsv,</span><br><span class="line">            <span class="number">1</span>,			<span class="comment">// histogram of 1 image only</span></span><br><span class="line">            channels,	<span class="comment">// the channel used</span></span><br><span class="line">            mask,		<span class="comment">// binary mask</span></span><br><span class="line">            hist,		<span class="comment">// the resulting histogram</span></span><br><span class="line">            <span class="number">1</span>,			<span class="comment">// it is a 1D histogram</span></span><br><span class="line">            histSize,	<span class="comment">// number of bins</span></span><br><span class="line">            ranges		<span class="comment">// pixel value range</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Computes the 2D ab histogram.</span></span><br><span class="line">    <span class="comment">// BGR source image is converted to Lab</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getabHistogram</span><span class="params">(<span class="type">const</span> cv::Mat &amp;image)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        cv::Mat hist;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Convert to Lab color space</span></span><br><span class="line">        cv::Mat lab;</span><br><span class="line">        cv::<span class="built_in">cvtColor</span>(image, lab, CV_BGR2Lab);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare arguments for a 2D color histogram</span></span><br><span class="line">        hranges[<span class="number">0</span>]= <span class="number">0</span>;</span><br><span class="line">        hranges[<span class="number">1</span>]= <span class="number">256.0</span>;</span><br><span class="line">        channels[<span class="number">0</span>]= <span class="number">1</span>; <span class="comment">// the two channels used are ab</span></span><br><span class="line">        channels[<span class="number">1</span>]= <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compute histogram</span></span><br><span class="line">        cv::<span class="built_in">calcHist</span>(&amp;lab,</span><br><span class="line">            <span class="number">1</span>,			<span class="comment">// histogram of 1 image only</span></span><br><span class="line">            channels,	<span class="comment">// the channel used</span></span><br><span class="line">            cv::<span class="built_in">Mat</span>(),	<span class="comment">// no mask is used</span></span><br><span class="line">            hist,		<span class="comment">// the resulting histogram</span></span><br><span class="line">            <span class="number">2</span>,			<span class="comment">// it is a 2D histogram</span></span><br><span class="line">            histSize,	<span class="comment">// number of bins</span></span><br><span class="line">            ranges		<span class="comment">// pixel value range</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CLIONS_COLORHISTOGRAM_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="contenfinder-h">contenfinder.h</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CLIONS_CONTENTFINDER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLIONS_CONTENTFINDER_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;highgui.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContentFinder</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// histogram parameters</span></span><br><span class="line">    <span class="type">float</span> hranges[<span class="number">2</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span>* ranges[<span class="number">3</span>];</span><br><span class="line">    <span class="type">int</span> channels[<span class="number">3</span>];</span><br><span class="line">    <span class="type">float</span> threshold; <span class="comment">//decision threshold</span></span><br><span class="line">    cv::Mat histogram;  <span class="comment">// input histogram</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ContentFinder</span>():<span class="built_in">threshold</span>(<span class="number">0.1f</span>)&#123;</span><br><span class="line">        <span class="comment">// in this class, all channels have the same range</span></span><br><span class="line">        ranges[<span class="number">0</span>] = hranges;</span><br><span class="line">        ranges[<span class="number">1</span>] = hranges;</span><br><span class="line">        ranges[<span class="number">2</span>] = hranges;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sets the refrence histogram</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setHistogram</span><span class="params">(<span class="type">const</span> cv::Mat&amp; h)</span></span>&#123;</span><br><span class="line">        histogram = h;</span><br><span class="line">        cv::<span class="built_in">normalize</span>(histogram, histogram, <span class="number">1.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sets the threshold</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setThreshold</span><span class="params">(<span class="type">float</span> f)</span></span>&#123;</span><br><span class="line">        threshold = f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Simplified version in which</span></span><br><span class="line">    <span class="comment">//all channels used, with range[0,256]</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">find</span><span class="params">(<span class="type">const</span> cv::Mat&amp; image)</span></span>&#123;</span><br><span class="line">        cv::Mat result;</span><br><span class="line">        hranges[<span class="number">0</span>] = <span class="number">0.0</span>;</span><br><span class="line">        hranges[<span class="number">1</span>] = <span class="number">256.0</span>;</span><br><span class="line">        channels[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        channels[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        channels[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">find</span>(image, hranges[<span class="number">0</span>], hranges[<span class="number">1</span>], channels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Finds the pixel belonging to the histogram</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">find</span><span class="params">(<span class="type">const</span> cv::Mat&amp; image, <span class="type">float</span> minValue, <span class="type">float</span> maxValue, <span class="type">int</span> * channels)</span></span>&#123;</span><br><span class="line">        cv::Mat result;</span><br><span class="line">        hranges[<span class="number">0</span>] = minValue;</span><br><span class="line">        hranges[<span class="number">1</span>] = maxValue;</span><br><span class="line">        <span class="comment">// histogram dim matches channel list</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;histogram.dims; i++)</span><br><span class="line">            <span class="keyword">this</span>-&gt;channels[i]=channels[i];</span><br><span class="line"></span><br><span class="line">        cv::<span class="built_in">calcBackProject</span>(&amp;image, <span class="number">1</span>,</span><br><span class="line">                            channels,</span><br><span class="line">                            histogram,</span><br><span class="line">                            result,</span><br><span class="line">                            ranges, <span class="number">255.0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(threshold&gt;<span class="number">0.0</span>)</span><br><span class="line">            cv::<span class="built_in">threshold</span>(result, result, <span class="number">255.0</span>*threshold, <span class="number">255.0</span>,cv::THRESH_BINARY);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CLIONS_CONTENTFINDER_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/04/Backprojecting-a-histogram-to/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/archives/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/archives/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/18/">18</a><a class="extend next" rel="next" href="/archives/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mathew Shen</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




<script class="next-config" data-name="valine" type="application/json">{"enable":true,"appId":"qzF75hQvs6yPkMIO7gd7LwDB-gzGzoHsz","appKey":"foULNoeGLTL8LE8C2Ysitv5I","serverURLs":["datahonor.com"],"placeholder":"毕竟今天太阳那么好~(评论时留下邮箱才能收到回复提醒的邮件哦)","avatar":"","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick"],"notify":true,"el":"#valine-comments","path":"/archives/page/11/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.valine.el)
    .then(() => NexT.utils.getScript(
      'https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js',
      { condition: window.Valine }
    ))
    .then(() => {
      new Valine(CONFIG.valine);
    });
});
</script>

</body>
</html>
