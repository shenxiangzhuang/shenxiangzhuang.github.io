<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"datahonor.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":"ture"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="十年饮冰，难凉热血。">
<meta property="og:type" content="website">
<meta property="og:title" content="DATA HONOR">
<meta property="og:url" content="http://datahonor.com/archives/page/10/index.html">
<meta property="og:site_name" content="DATA HONOR">
<meta property="og:description" content="十年饮冰，难凉热血。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mathew Shen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://datahonor.com/archives/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"archives/page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>DATA HONOR</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">DATA HONOR</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Pain Is Inevitable; Suffering Is Optional</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mathew Shen"
      src="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
  <p class="site-author-name" itemprop="name">Mathew Shen</p>
  <div class="site-description" itemprop="description">十年饮冰，难凉热血。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenxiangzhuang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenxiangzhuang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:datahonor@gmail.com" title="E-Mail → mailto:datahonor@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://yuanhang0.github.io/" title="https:&#x2F;&#x2F;yuanhang0.github.io&#x2F;" rel="noopener" target="_blank">Tomorrow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yudaer.github.io/" title="http:&#x2F;&#x2F;yudaer.github.io&#x2F;" rel="noopener" target="_blank">小白二号</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/06/24/%E8%BF%99%E4%B8%80%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BA%8C%E5%8D%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/24/%E8%BF%99%E4%B8%80%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BA%8C%E5%8D%81/" class="post-title-link" itemprop="url">这一年，我二十</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-24 16:25:34" itemprop="dateCreated datePublished" datetime="2017-06-24T16:25:34+08:00">2017-06-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/06/24/%E8%BF%99%E4%B8%80%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BA%8C%E5%8D%81/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/06/24/%E8%BF%99%E4%B8%80%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BA%8C%E5%8D%81/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>      这一年，在今天，我刚好二十岁。<br>
      二十岁是每个人的黄金时代，是野蛮生长的年纪，是为之后披荆斩棘准备本钱的年纪。加油！</p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/06/24/%E8%BF%99%E4%B8%80%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BA%8C%E5%8D%81/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/28/Hough%E5%8F%98%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/28/Hough%E5%8F%98%E6%8D%A2/" class="post-title-link" itemprop="url">Hough变换</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-28 11:13:36" itemprop="dateCreated datePublished" datetime="2017-05-28T11:13:36+08:00">2017-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/28/Hough%E5%8F%98%E6%8D%A2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/28/Hough%E5%8F%98%E6%8D%A2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-19">Overview</h4>
<p>关于hough变换，确实被它的奇妙思想震撼到。</p>
<blockquote>
<p>图像空间中共线的点对应参数空间共点的线。</p>
</blockquote>
<p>于是就尝试去实现这个变换.</p>
<h4 id="Code-17">Code</h4>
<h5 id="Python">Python</h5>
<p>先用Python写了个demo，效果还是可以的，但是写的略显粗糙…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取原空间的点</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_raw_points</span>():</span><br><span class="line">    points = np.array([[<span class="number">1</span>,<span class="number">1</span>], [<span class="number">2</span>,<span class="number">2</span>], [<span class="number">3</span>,<span class="number">3</span>], [<span class="number">1</span>,<span class="number">2</span>], [<span class="number">2</span>,<span class="number">1</span>]])</span><br><span class="line">    <span class="keyword">return</span> points</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取原空间点对应的线</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_line</span>(<span class="params">points</span>):</span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    para_points = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> point <span class="keyword">in</span> points:</span><br><span class="line">        a = point[<span class="number">0</span>]</span><br><span class="line">        b = point[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        para_X = np.linspace(-<span class="number">5</span>, <span class="number">5</span>, <span class="number">101</span>)</span><br><span class="line">        para_Y = a * para_X + b</span><br><span class="line">        plt.plot(para_X, para_Y)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(para_X)):</span><br><span class="line">            para_x = np.<span class="built_in">round</span>(para_X[i], <span class="number">3</span>)</span><br><span class="line">            para_y = np.<span class="built_in">round</span>(para_Y[i], <span class="number">3</span>)</span><br><span class="line">            <span class="comment"># para_points.append([para_x, para_y])</span></span><br><span class="line">            para_str = <span class="built_in">str</span>(np.<span class="built_in">round</span>([para_x, para_y], <span class="number">3</span>))</span><br><span class="line">            <span class="keyword">if</span> para_str <span class="keyword">not</span> <span class="keyword">in</span> para_points.keys():</span><br><span class="line">                para_points[para_str] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                para_points[para_str] += <span class="number">1</span></span><br><span class="line">    plt.legend([<span class="string">&#x27;(1,1)&#x27;</span>, <span class="string">&#x27;(2,2)&#x27;</span>, <span class="string">&#x27;(3,3)&#x27;</span>, <span class="string">&#x27;(1,2)&#x27;</span>, <span class="string">&#x27;(2,1)&#x27;</span>])</span><br><span class="line">    <span class="comment"># 按照交点个数排序</span></span><br><span class="line">    sorted_para_points = <span class="built_in">sorted</span>(para_points.items(), key=operator.itemgetter(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取其中的交点,这里就简短地从结果看下，直接切片了</span></span><br><span class="line">    <span class="comment"># 正规是根据点的value来取的，也不麻烦。</span></span><br><span class="line">    more_points = sorted_para_points[-<span class="number">6</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The point that we want to find!</span></span><br><span class="line">    <span class="comment"># 这里可以用正则...前面写的太粗糙了，这里就取点比较麻烦了</span></span><br><span class="line">    <span class="comment"># 绿色点标记交点</span></span><br><span class="line">    plt.plot(-<span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;go&#x27;</span>, linewidth=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># plt.show()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> more_points</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在hough变换后找到直线[a,b]后，在原空间画出此直线</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot_point_line</span>():</span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    points = get_raw_points()</span><br><span class="line">    plt.plot(points[:,<span class="number">0</span>], points[:,<span class="number">1</span>], <span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">    <span class="comment"># [-1,0]--&gt; 0=-a+b --&gt; b=a --&gt; y=x</span></span><br><span class="line"></span><br><span class="line">    X = np.linspace(-<span class="number">2</span>,<span class="number">5</span>,<span class="number">101</span>)</span><br><span class="line">    Y= X</span><br><span class="line">    plt.plot(X, Y, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    points = get_raw_points()</span><br><span class="line">    more_points = get_line(points)</span><br><span class="line">    plot_point_line()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Figure%201_052801.png" alt><br>
<img src="http://blog-1252464519.costj.myqcloud.com/1705/Figure%202_052802.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/28/Hough%E5%8F%98%E6%8D%A2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/27/Extracting-Lines-Contours-and-Components/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/27/Extracting-Lines-Contours-and-Components/" class="post-title-link" itemprop="url">OpenCV系列笔记二十三：Extracting Lines, Contours, and Components</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-27 09:01:01" itemprop="dateCreated datePublished" datetime="2017-05-27T09:01:01+08:00">2017-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/27/Extracting-Lines-Contours-and-Components/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/27/Extracting-Lines-Contours-and-Components/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-14">Overview</h4>
<p>我们这里介绍怎样从图像中抽取一些有用的特征来进行图像的分析。</p>
<blockquote>
<p>In order to perform content-based analysis of an image, it is necessary to<br>
extract meaningful features from the collection of pixels that constitute<br>
the image.</p>
</blockquote>
<h4 id="Code-12">Code</h4>
<h5 id="Find-contours-by-Canny-operator">Find contours by Canny operator</h5>
<p>之前，我们也简单介绍了基于梯度的图像的边缘检测，但是有两个缺点：第一是边缘有些厚，第二用于分割的阀值很难找到。所以我们这里介绍Canny算子。</p>
<p>原理部分，参考<a target="_blank" rel="noopener" href="http://docs.opencv.org/2.4/doc/tutorials/imgproc/imgtrans/canny_detector/canny_detector.html">文档</a>,写的很精彩。主要就是Non-maximum suppression和Hysteresis threshold的理解。</p>
<p>一个简单的demo:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/road.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Original Image&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply Canny algorithm</span></span><br><span class="line">    cv::Mat contours;</span><br><span class="line">    cv::<span class="built_in">Canny</span>(image, contours, <span class="number">125</span>, <span class="number">350</span>);  <span class="comment">// contours &#123;0,255&#125;,边缘为255</span></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Canny Image&quot;</span>);</span><br><span class="line">    <span class="comment">// 为了便于观察，取反色</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Canny Image&quot;</span>, <span class="number">255</span>-contours);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/27/Extracting-Lines-Contours-and-Components/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%9A%E6%BB%A4%E6%B3%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%9A%E6%BB%A4%E6%B3%A2/" class="post-title-link" itemprop="url">OpenCV系列笔记二十二：滤波</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-25 15:33:11" itemprop="dateCreated datePublished" datetime="2017-05-25T15:33:11+08:00">2017-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%9A%E6%BB%A4%E6%B3%A2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%9A%E6%BB%A4%E6%B3%A2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-36">Overview</h4>
<p>滤波在信号处理领域具有广泛的应用。同样的，我们可以通过 Fourier transform 或者 Cosine transform将空域（ spatial domain）上的图像信息转化到频域（frequency domain）。这里我们暂时不做深入了解，只需要了解：图像中的一些边缘和细节（变化较大的部分）对应频域中的高频部分，图像中较为平坦，变化不大的地方对应频域的低频部分。</p>
<p>基于上面的结论，我们称进行滤波的工具为滤波器(filter)，根据不同的过滤方式分为低通滤波器（ low-pass filter ）和高通滤波器( high-pass filter ).</p>
<p>我们将展示mean filter, gaussian filter, median filter 等多种滤波器的使用。</p>
<h4 id="Code-29">Code</h4>
<h5 id="Downsampling-images-with-filters">Downsampling images with filters</h5>
<p>我们在进行downsampling的时候，如果不进行低通滤波器的处理，直接去除行列的话，结果会比较糟糕：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052501.png" alt></p>
<p>可以看到，在直接downsampling的时候，原图像的细节，也就是高频部分无法在如此小的空间（如此少的像素数）上表现出来，还会出现spatial aliasing的现象。所以，我们一般进经过low-pass filter处理后在进行downsampling，这种做法即是遵从 Nyquist-Shannon theorem.而效果也是有较高的提升的：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052502.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%9A%E6%BB%A4%E6%B3%A2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%9AMSER/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%9AMSER/" class="post-title-link" itemprop="url">OpenCV系列笔记二十一：MSER</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-25 00:06:22" itemprop="dateCreated datePublished" datetime="2017-05-25T00:06:22+08:00">2017-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%9AMSER/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%9AMSER/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-35">Overview</h4>
<p>Maximally Stable External Regions (MSER) 和分水岭算法类似，也是通过一种类似“浸水”的过程来找到图像中一些有意义的区域。但是和分水岭算法又有些不同：</p>
<blockquote>
<p>but this time, we will be interested in the basins that remain relatively stable for a period of time during the immersion process. It will be observed that these regions correspond to some distinctive parts of the scene objects pictured in the image.</p>
</blockquote>
<p>也就是说，这里关注的不仅仅是界限，更多地考虑随着浸水过程的进行，特定区域是否有明显的变化（比如当前区域的水面面积的方差是否小于给定的阀值），如果在一段浸水时间内，某些区域的面积未有太大的变化，那么这就是我们要找的MSER。</p>
<h4 id="Code-28">Code</h4>
<p>这里做图的时候要注意两点。第一，检测到的MSER是具有层级结构的，我们在绘图的时候要按照从大到小（面积）的顺序，且每次做图进行检查当前区域是否已经画过了。第二，这里会返回包含MSER的矩形，不过一般来说数目较多，全部做出来会使得结果显得比较凌乱，所以一般添加一些过滤条件来指定输出某些物体，比如通过指定矩形的长宽比来来输出包含窗户的矩形框。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Read the image</span></span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/building.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(!image.data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Display the image</span></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;Image&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Image&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// basic MSER detector</span></span><br><span class="line">    cv::Ptr&lt;cv::MSER&gt;ptrMSER = cv::MSER::<span class="built_in">create</span>(<span class="number">5</span>,  <span class="comment">// delta value</span></span><br><span class="line">                                                  <span class="number">200</span>,  <span class="comment">// min acceptable area</span></span><br><span class="line">                                                     <span class="number">2000</span>); <span class="comment">// max acceptable area</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// vector of point sets</span></span><br><span class="line">    std::vector&lt;std::vector&lt;cv::Point&gt;&gt;points;</span><br><span class="line">    <span class="comment">// vector of rectangles</span></span><br><span class="line">    std::vector&lt;cv::Rect&gt;rects;</span><br><span class="line">    <span class="comment">// detect MSER features</span></span><br><span class="line">    ptrMSER-&gt;<span class="built_in">detectRegions</span>(image, points, rects);</span><br><span class="line"></span><br><span class="line">    std::cout&lt;&lt;points.<span class="built_in">size</span>()&lt;&lt;<span class="string">&quot; MSERs detected&quot;</span>&lt;&lt;std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create white image</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">output</span><span class="params">(image.size(), CV_8UC3)</span></span>;</span><br><span class="line">    output = cv::<span class="built_in">Scalar</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OpenCV random number  generator</span></span><br><span class="line">    cv::RNG rng;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Display the MSERs in color areas</span></span><br><span class="line">    <span class="comment">// for each detected feature</span></span><br><span class="line">    <span class="comment">// reverse order to display the larger MSER first</span></span><br><span class="line">    <span class="keyword">for</span>(std::vector&lt;std::vector&lt;cv::Point&gt;&gt;::reverse_iterator it = points.<span class="built_in">rbegin</span>();</span><br><span class="line">            it!=points.<span class="built_in">rend</span>(); ++it)&#123;</span><br><span class="line">        <span class="comment">// generate a random color</span></span><br><span class="line">        <span class="function">cv::Vec3b <span class="title">c</span><span class="params">(rng.uniform(<span class="number">0</span>,<span class="number">254</span>), rng.uniform(<span class="number">0</span>,<span class="number">254</span>), rng.uniform(<span class="number">0</span>,<span class="number">254</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;MSER size= &quot;</span>&lt;&lt;it-&gt;<span class="built_in">size</span>()&lt;&lt;std::endl;</span><br><span class="line">        <span class="comment">// for each point in MSER set</span></span><br><span class="line">        <span class="keyword">for</span>(std::vector&lt;cv::Point&gt;::iterator itPts = it-&gt;<span class="built_in">begin</span>();</span><br><span class="line">                itPts!=it-&gt;<span class="built_in">end</span>(); ++itPts)&#123;</span><br><span class="line">            <span class="comment">// do not overwrite MSER pixels</span></span><br><span class="line">            <span class="keyword">if</span>(output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(*itPts)[<span class="number">0</span>] = <span class="number">255</span>)&#123;</span><br><span class="line">                output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(*itPts) = c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;MSER point sets&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;MSER point sets&quot;</span>, output);</span><br><span class="line">    cv::<span class="built_in">imwrite</span>(<span class="string">&quot;mser.bmp&quot;</span>, output);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reload the input image</span></span><br><span class="line">    image = cv::<span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/building.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (!image.data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Extract and display the elliptic MSERs</span></span><br><span class="line">    <span class="keyword">for</span> (std::vector&lt;std::vector&lt;cv::Point&gt; &gt;::iterator it = points.<span class="built_in">begin</span>();</span><br><span class="line">         it != points.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// for each point in MSER set</span></span><br><span class="line">        <span class="keyword">for</span> (std::vector&lt;cv::Point&gt;::iterator itPts = it-&gt;<span class="built_in">begin</span>();</span><br><span class="line">             itPts != it-&gt;<span class="built_in">end</span>(); ++itPts) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Extract bouding rectangles</span></span><br><span class="line">            cv::RotatedRect rr = cv::<span class="built_in">minAreaRect</span>(*it);</span><br><span class="line">            <span class="comment">// check ellipse elongation</span></span><br><span class="line">            <span class="keyword">if</span> (rr.size.height / rr.size.height &gt; <span class="number">0.6</span> || rr.size.height / rr.size.height &lt; <span class="number">1.6</span>)</span><br><span class="line">                cv::<span class="built_in">ellipse</span>(image, rr, cv::<span class="built_in">Scalar</span>(<span class="number">255</span>), <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Display the image</span></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;MSER ellipses&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;MSER ellipses&quot;</span>, image);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/1705/Selection_052404.png" alt></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/25/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%9AMSER/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/24/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%EF%BC%9ASegmenting-images-using/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/24/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%EF%BC%9ASegmenting-images-using/" class="post-title-link" itemprop="url">OpenCV系列笔记二十：Segmenting images using watersheds</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-24 23:19:35" itemprop="dateCreated datePublished" datetime="2017-05-24T23:19:35+08:00">2017-05-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/24/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%EF%BC%9ASegmenting-images-using/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/24/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%EF%BC%9ASegmenting-images-using/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-38">Overview</h4>
<p>关于分水岭算法：</p>
<blockquote>
<p>The watershed transformation is a popular image processing algorithm that is used to quickly segment an image into homogenous regions. It relies on the idea that when the image is seen as a topological relief, the homogeneous regions correspond to relatively flat basins delimited by steep edges.</p>
</blockquote>
<p>在同质区域的分割里，watersheds是很好用的一个算法，但是其存在over-segment的问题，也就是会错误地分割出很多小的区域。这点我们可以通过在应用算法前手动添加标记来弥补。</p>
<p>算法的进一步理解：</p>
<blockquote>
<p>use the topological map analogy in the description of the watershed algorithm. In order to create watershed segmentation, the idea is to progressively flood the image starting at level 0. As the level of water progressively increases (to levels 1, 2, 3, and so on), catchment basins are formed. The size of these basins also gradually increases and, consequently, the water of two different basins will eventually merge. When this happens, a watershed is created in order to keep the two basins separated. Once the level of water has reached its maximum level, the sets of these created basins and watersheds form the watershed segmentation.</p>
</blockquote>
<h4 id="Code-31">Code</h4>
<h5 id="watershedSegmentation-h">watershedSegmentation.h</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CLIONS_WATERSHEDSEGMENTATION_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLIONS_WATERSHEDSEGMENTATION_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//CLIONS_WATERSHEDSEGMENTATION_H</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WatershedSegmenter</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    cv::Mat markers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMarkers</span><span class="params">(<span class="type">const</span> cv::Mat&amp; markerImage)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Convert to image of ints</span></span><br><span class="line">        markerImage.<span class="built_in">convertTo</span>(markers, CV_32S);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">cv::Mat <span class="title">process</span><span class="params">(<span class="type">const</span> cv::Mat &amp; image)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Apply watershed</span></span><br><span class="line">        cv::<span class="built_in">watershed</span>(image, markers);</span><br><span class="line">        <span class="keyword">return</span> markers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return result in the form of an image</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getSegmentation</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cv::Mat tmp;</span><br><span class="line">        <span class="comment">// all segment with label higher than 255</span></span><br><span class="line">        <span class="comment">// will be assigned value 255</span></span><br><span class="line">        markers.<span class="built_in">convertTo</span>(tmp, CV_8U);</span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return watershed in the form of an image</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">getWatersheds</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cv::Mat tmp;</span><br><span class="line">        <span class="comment">// -1*255+255 = 0  --&gt; 分水岭算法将边界标记为-1，如此转化为0，黑色，其余全白色</span></span><br><span class="line">        markers.<span class="built_in">convertTo</span>(tmp, CV_8U, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="main-cpp-7">main.cpp</h5>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/24/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%BA%8C%E5%8D%81%EF%BC%9ASegmenting-images-using/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/19/%E8%83%8C%E6%99%AF%E5%BB%BA%E6%A8%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/19/%E8%83%8C%E6%99%AF%E5%BB%BA%E6%A8%A1/" class="post-title-link" itemprop="url">背景建模</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-19 00:54:03" itemprop="dateCreated datePublished" datetime="2017-05-19T00:54:03+08:00">2017-05-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/19/%E8%83%8C%E6%99%AF%E5%BB%BA%E6%A8%A1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/19/%E8%83%8C%E6%99%AF%E5%BB%BA%E6%A8%A1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-64">Overview</h4>
<p>背景建模在视频监控等动态图像的检测上有很重要的位置.这篇文章将会逐渐学习一系列的背景建模方法.</p>
<h4 id="Code-53">Code</h4>
<h5 id="简单背景差分">简单背景差分</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Mat back1, back2;</span><br><span class="line">    back1 = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/back1.jpg&quot;</span>);</span><br><span class="line">    back2 = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/back2.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Mat Original_img = back1.<span class="built_in">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cvtColor</span>(back1, back1, COLOR_BGR2GRAY);</span><br><span class="line">    <span class="built_in">cvtColor</span>(back2, back2, COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">resize</span>(back1, back1, <span class="built_in">Size</span>(), <span class="number">0.1</span>, <span class="number">0.1</span>);</span><br><span class="line">    <span class="built_in">resize</span>(back2, back2, <span class="built_in">Size</span>(), <span class="number">0.1</span>, <span class="number">0.1</span>);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;back1&quot;</span>, back1);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;back2&quot;</span>, back2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直接相减</span></span><br><span class="line">    Mat result = back2 - back1;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出:<br>
<img src="http://blog-1252464519.costj.myqcloud.com/170518/Selection_051901.png" alt></p>
<p>可以看到，直接相减再thresh一下，效果还是比较好的。但是在实际上，这种方法要求比较高，它要求背景图像是静止的，任何微小的背景变动都会对检测造成影响：</p>
<blockquote>
<p>In this approach, we assume that the background is static. If some parts of our background start moving, then those parts will start getting detected as new objects. So, even if the movements are minor, say a waving flag, it will cause problems in our detection algorithm. This approach is also sensitive to changes in illumination, and it cannot handle any camera movement. Needless to say, it’s a delicate approach! We need something that can handle all these things in the real world.</p>
</blockquote>
<h5 id="帧差值法">帧差值法</h5>
<p>帧差值法是利用连续帧之间的差异来获取物体的移动信息。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/19/%E8%83%8C%E6%99%AF%E5%BB%BA%E6%A8%A1/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/18/%E5%AE%9E%E6%97%B6%E8%A7%86%E9%A2%91%E4%B8%AD%E9%9D%A2%E5%85%B7%E8%A6%86%E7%9B%96%E7%9A%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/18/%E5%AE%9E%E6%97%B6%E8%A7%86%E9%A2%91%E4%B8%AD%E9%9D%A2%E5%85%B7%E8%A6%86%E7%9B%96%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">实时视频中面具覆盖的实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-18 23:44:17" itemprop="dateCreated datePublished" datetime="2017-05-18T23:44:17+08:00">2017-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/18/%E5%AE%9E%E6%97%B6%E8%A7%86%E9%A2%91%E4%B8%AD%E9%9D%A2%E5%85%B7%E8%A6%86%E7%9B%96%E7%9A%84%E5%AE%9E%E7%8E%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/18/%E5%AE%9E%E6%97%B6%E8%A7%86%E9%A2%91%E4%B8%AD%E9%9D%A2%E5%85%B7%E8%A6%86%E7%9B%96%E7%9A%84%E5%AE%9E%E7%8E%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-59">Overview</h4>
<p><em>OpenCV By Example</em>第七章中的一个例子，识别算法是直接加载的给定的级联文件（书中的代码给提供了一份，OpenCV官方应该也能找的到）。检测到人脸之后就是面具的覆盖，这个过程类似之前的<a href="http://datahonor.com/2017/04/28/OpenCV%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E5%9B%9B%EF%BC%9AROI/">logo添加</a>,就是logo(此处是facemask)和背景(此处是人脸ROI)的对称的操作，之后将两者直接合并即可。</p>
<h4 id="Code-51">Code</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv/cv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    string faceCascadeName = <span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/books/CV/2-ing/9781785280948_Code/B04283_07_code/code/cascadeFiles/haarcascade_frontalface_alt.xml&quot;</span>;</span><br><span class="line">    CascadeClassifier faceCascade;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( !faceCascade.<span class="built_in">load</span>(faceCascadeName) )</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Error loading cascade file. Exiting!&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat faceMask = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/mask2.jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !faceMask.data )</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Error loading mask image. Exiting!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Current frame</span></span><br><span class="line">    Mat frame, frameGray;</span><br><span class="line">    Mat frameROI, faceMaskSmall;</span><br><span class="line">    Mat grayMaskSmall, grayMaskSmallThresh, grayMaskSmallThreshInv;</span><br><span class="line">    Mat maskedFace, maskedFrame;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> ch;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create the capture object</span></span><br><span class="line">    <span class="comment">// 0 -&gt; input arg that specifies it should take the input from the webcam</span></span><br><span class="line">    <span class="function">VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If you cannot open the webcam, stop the execution!</span></span><br><span class="line">    <span class="keyword">if</span>( !cap.<span class="built_in">isOpened</span>() )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//create GUI windows</span></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Frame&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Scaling factor to resize the input frames from the webcam</span></span><br><span class="line">    <span class="type">float</span> scalingFactor = <span class="number">0.75</span>;</span><br><span class="line"></span><br><span class="line">    vector&lt;Rect&gt; faces;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Iterate until the user presses the Esc key</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Capture the current frame</span></span><br><span class="line">        cap &gt;&gt; frame;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Resize the frame</span></span><br><span class="line">        <span class="built_in">resize</span>(frame, frame, <span class="built_in">Size</span>(), scalingFactor, scalingFactor, INTER_AREA);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Convert to grayscale</span></span><br><span class="line">        <span class="built_in">cvtColor</span>(frame, frameGray, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Equalize the histogram</span></span><br><span class="line">        <span class="built_in">equalizeHist</span>(frameGray, frameGray);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Detect faces</span></span><br><span class="line">        faceCascade.<span class="built_in">detectMultiScale</span>(frameGray, faces, <span class="number">1.1</span>, <span class="number">2</span>, <span class="number">0</span>|CV_HAAR_SCALE_IMAGE, <span class="built_in">Size</span>(<span class="number">30</span>, <span class="number">30</span>) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Draw green rectangle around the face</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; faces.<span class="built_in">size</span>(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">Rect <span class="title">faceRect</span><span class="params">(faces[i].x, faces[i].y, faces[i].width, faces[i].height)</span></span>;</span><br><span class="line">            <span class="built_in">rectangle</span>(frame, faceRect, <span class="built_in">Scalar</span>(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Custom parameters to make the mask fit your face. You may have to play around with them to make sure it works.</span></span><br><span class="line">            <span class="type">int</span> x = faces[i].x - <span class="built_in">int</span>(<span class="number">0.1</span>*faces[i].width);</span><br><span class="line">            <span class="type">int</span> y = faces[i].y - <span class="built_in">int</span>(<span class="number">0.0</span>*faces[i].height);</span><br><span class="line">            <span class="type">int</span> w = <span class="built_in">int</span>(<span class="number">1.3</span> * faces[i].width);</span><br><span class="line">            <span class="type">int</span> h = <span class="built_in">int</span>(<span class="number">1.3</span> * faces[i].height);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Extract region of interest (ROI) covering your face</span></span><br><span class="line">            frameROI = <span class="built_in">frame</span>(<span class="built_in">Rect</span>(x,y,w,h));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Resize the face mask image based on the dimensions of the above ROI</span></span><br><span class="line">            <span class="built_in">resize</span>(faceMask, faceMaskSmall, <span class="built_in">Size</span>(w,h));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Convert the above image to grayscale</span></span><br><span class="line">            <span class="comment">// 灰度化</span></span><br><span class="line">            <span class="built_in">cvtColor</span>(faceMaskSmall, grayMaskSmall, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Threshold the above image to isolate the pixels associated only with the face mask</span></span><br><span class="line">            <span class="comment">// 二值化，grayMaskSmallThresh在面具主体为白，其余为黑色</span></span><br><span class="line">            <span class="built_in">threshold</span>(grayMaskSmall, grayMaskSmallThresh, <span class="number">230</span>, <span class="number">255</span>, CV_THRESH_BINARY_INV);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create mask by inverting the above image (because we don&#x27;t want the background to affect the overlay)</span></span><br><span class="line">            <span class="comment">// grayMaskSmallThreshInv在面具主体为黑色，其余为白色</span></span><br><span class="line">            <span class="built_in">bitwise_not</span>(grayMaskSmallThresh, grayMaskSmallThreshInv);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Use bitwise &quot;AND&quot; operator to extract precise boundary of face mask</span></span><br><span class="line">            <span class="comment">// 扣取面具主体，周围为黑色</span></span><br><span class="line">            <span class="built_in">bitwise_and</span>(faceMaskSmall, faceMaskSmall, maskedFace, grayMaskSmallThresh);</span><br><span class="line">            <span class="built_in">imshow</span>(<span class="string">&quot;maskedFace&quot;</span>, maskedFace);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Use bitwise &quot;AND&quot; operator to overlay face mask</span></span><br><span class="line">            <span class="comment">// 挖去ROI中的脸部图像，变为黑色，其余保持不变</span></span><br><span class="line">            <span class="built_in">bitwise_and</span>(frameROI, frameROI, maskedFrame, grayMaskSmallThreshInv);</span><br><span class="line">            <span class="built_in">imshow</span>(<span class="string">&quot;maskedFrame&quot;</span>, maskedFrame);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add the above masked images and place it in the original frame ROI to create the final image</span></span><br><span class="line">            <span class="comment">// 面具部分覆盖脸部主体，其余部分合成后保持不变</span></span><br><span class="line">            <span class="built_in">add</span>(maskedFace, maskedFrame, <span class="built_in">frame</span>(<span class="built_in">Rect</span>(x,y,w,h)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Show the current frame</span></span><br><span class="line">        <span class="built_in">imshow</span>(<span class="string">&quot;Frame&quot;</span>, frame);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the keyboard input and check if it&#x27;s &#x27;Esc&#x27;</span></span><br><span class="line">        <span class="comment">// 27 -&gt; ASCII value of &#x27;Esc&#x27; key</span></span><br><span class="line">        ch = <span class="built_in">waitKey</span>( <span class="number">30</span> );</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="number">27</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Release the video capture object</span></span><br><span class="line">    cap.<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Close all windows</span></span><br><span class="line">    <span class="built_in">destroyAllWindows</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170518/Selection_051805.png" alt></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/18/%E5%AE%9E%E6%97%B6%E8%A7%86%E9%A2%91%E4%B8%AD%E9%9D%A2%E5%85%B7%E8%A6%86%E7%9B%96%E7%9A%84%E5%AE%9E%E7%8E%B0/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/18/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/18/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%88%86%E7%B1%BB/" class="post-title-link" itemprop="url">学习目标分类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-18 17:58:12" itemprop="dateCreated datePublished" datetime="2017-05-18T17:58:12+08:00">2017-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/18/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%88%86%E7%B1%BB/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/18/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%88%86%E7%B1%BB/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-58">Overview</h4>
<p>还是<em>OpenCV By Example</em>， 承接上文的目标分割和检测，这里用SVM进行了分类的学习。由于从PACKT下载的代码是基于QT的，而我。。开始编译OpenCV没有选QT支持，重新编译也一致出错，就暂时没去用QT的按钮那些功能，也就没QT进行编译了。。扯多了，回到正题。代码应该是有一些bug的，折腾了一下午才调试好…</p>
<p>原理还是比较简单的，处理的流程也较为清晰。对图片主要是进行了中值滤波，去除光纹，和灰度二值化提取轮廓的操作。抽取螺丝环，螺母，螺丝钉的面积和长宽比这两个特征进行训练，测试误差在2%以下，看书上的截图，原作的误差在7%左右…可能和OpenCV的改进有关吧。</p>
<h4 id="Code-50">Code</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by shensir on 17-5-17.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/ml.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv::ml;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一些全局变量</span></span><br><span class="line">Mat light_pattern;</span><br><span class="line">Ptr&lt;SVM&gt; svm;</span><br><span class="line"><span class="function">Scalar <span class="title">green</span><span class="params">(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>)</span>, <span class="title">blue</span> <span class="params">(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>)</span>, <span class="title">red</span> <span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 光纹去除</span></span><br><span class="line"><span class="function">Mat <span class="title">removeLight</span><span class="params">(Mat img, Mat pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Mat aux;</span><br><span class="line">    <span class="comment">// Require change our image to 32 float for division</span></span><br><span class="line">    Mat img32, pattern32;</span><br><span class="line">    img.<span class="built_in">convertTo</span>(img32, CV_32F);</span><br><span class="line">    pattern.<span class="built_in">convertTo</span>(pattern32, CV_32F);</span><br><span class="line">    <span class="comment">// Divide the imabe by the pattern</span></span><br><span class="line">    aux= <span class="number">255</span>*(<span class="number">1</span>-(img32/pattern32));</span><br><span class="line">    <span class="comment">// Convert 8 bits format</span></span><br><span class="line">    aux.<span class="built_in">convertTo</span>(aux, CV_8U);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> aux;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 特征抽取，这里抽取面积及宽高比</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">float</span>&gt; &gt; <span class="built_in">ExtractFeatures</span>(Mat img, vector&lt;<span class="type">int</span>&gt;*left=<span class="literal">NULL</span>, vector&lt;<span class="type">int</span>&gt;*top=<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//    count_num +=1;</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">float</span>&gt;&gt; output;</span><br><span class="line">    vector&lt;vector&lt;Point&gt;&gt; contours;</span><br><span class="line">    Mat input = img.<span class="built_in">clone</span>();</span><br><span class="line"></span><br><span class="line">    vector&lt;Vec4i&gt;hierarchy;</span><br><span class="line">    <span class="built_in">findContours</span>(input, contours, hierarchy, RETR_CCOMP, CHAIN_APPROX_SIMPLE);</span><br><span class="line">    <span class="comment">// 检查被检测到的物体个数</span></span><br><span class="line">    <span class="keyword">if</span>(contours.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> output;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;contours.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        Mat mask = Mat::<span class="built_in">zeros</span>(img.rows, img.cols, CV_8UC1);</span><br><span class="line">        <span class="built_in">drawContours</span>(mask, contours, i, <span class="built_in">Scalar</span>(<span class="number">1</span>), FILLED, LINE_8, hierarchy, <span class="number">1</span>);</span><br><span class="line">        Scalar area_s = <span class="built_in">sum</span>(mask);</span><br><span class="line">        <span class="type">float</span> area = area_s[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(area&gt;<span class="number">500</span>)&#123;<span class="comment">// 如果area大于面积最小阀值</span></span><br><span class="line">            RotatedRect r = <span class="built_in">minAreaRect</span>(contours[i]);</span><br><span class="line">            <span class="type">float</span> width = r.size.width;</span><br><span class="line">            <span class="type">float</span> height = r.size.height;</span><br><span class="line">            <span class="type">float</span> ar = (width&lt;height)?height/width:width/height;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 存储特征数据</span></span><br><span class="line">            vector&lt;<span class="type">float</span>&gt; row;</span><br><span class="line">            row.<span class="built_in">push_back</span>(area);</span><br><span class="line">            row.<span class="built_in">push_back</span>(ar);</span><br><span class="line">            output.<span class="built_in">push_back</span>(row);</span><br><span class="line">            <span class="comment">// 用于添加文字时候的定位</span></span><br><span class="line">            <span class="keyword">if</span>(left!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                left-&gt;<span class="built_in">push_back</span>(<span class="built_in">int</span>(r.center.x));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(top!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                top-&gt;<span class="built_in">push_back</span>(<span class="built_in">int</span>(r.center.y));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 显示特征抽取的结果</span></span><br><span class="line">            <span class="built_in">imshow</span>(<span class="string">&quot;Extract Features&quot;</span>, mask*<span class="number">255</span>);</span><br><span class="line">            <span class="built_in">waitKey</span>(<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片预处理</span></span><br><span class="line"><span class="function">Mat <span class="title">preprocessImage</span><span class="params">(Mat input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 灰度化</span></span><br><span class="line">    <span class="keyword">if</span>(input.<span class="built_in">channels</span>()!=<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">cvtColor</span>(input, input, COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    Mat result;</span><br><span class="line">    <span class="comment">// Remove noise</span></span><br><span class="line">    Mat img_noise;</span><br><span class="line">    <span class="built_in">medianBlur</span>(input, img_noise, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">//Apply the light pattern</span></span><br><span class="line">    Mat img_no_light;</span><br><span class="line">    img_noise.<span class="built_in">copyTo</span>(img_no_light);</span><br><span class="line">    <span class="comment">// 去除光纹</span></span><br><span class="line">    img_no_light= <span class="built_in">removeLight</span>(img_noise, light_pattern);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Binarize image for segment</span></span><br><span class="line">    <span class="built_in">threshold</span>(img_no_light, result, <span class="number">30</span>, <span class="number">255</span>, THRESH_BINARY);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从文件批量读取图片，并进行特征抽取</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">readFolderAndExtractFeatures</span><span class="params">(string folder, <span class="type">int</span> label, <span class="type">int</span> num_for_test,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    vector&lt;<span class="type">float</span>&gt;&amp;trainingData, vector&lt;<span class="type">int</span>&gt;&amp;responeseData,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    vector&lt;<span class="type">float</span>&gt;&amp;testData, vector&lt;<span class="type">float</span>&gt;&amp;testResponsesData)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">VideoCapture <span class="title">images</span><span class="params">(folder)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(images.<span class="built_in">open</span>(folder) == <span class="literal">false</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Can not open the folder images&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat frame;</span><br><span class="line">    <span class="type">int</span> img_index=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(images.<span class="built_in">read</span>(frame))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 预处理图像</span></span><br><span class="line">        images&gt;&gt;frame;  <span class="comment">//  书上参考代码没有这句，貌似bug...</span></span><br><span class="line">        <span class="keyword">if</span>(!frame.<span class="built_in">empty</span>())&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 预处理</span></span><br><span class="line">            Mat pre = <span class="built_in">preprocessImage</span>(frame);</span><br><span class="line">            <span class="comment">// 提取特征</span></span><br><span class="line">            vector&lt;vector&lt;<span class="type">float</span>&gt;&gt; features = <span class="built_in">ExtractFeatures</span>(pre);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;features.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(img_index &gt;= num_for_test)&#123;</span><br><span class="line">                    trainingData.<span class="built_in">push_back</span>(features[i][<span class="number">0</span>]);</span><br><span class="line">                    trainingData.<span class="built_in">push_back</span>(features[i][<span class="number">1</span>]);</span><br><span class="line">                    responeseData.<span class="built_in">push_back</span>(label);</span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    testData.<span class="built_in">push_back</span>(features[i][<span class="number">0</span>]);</span><br><span class="line">                    testData.<span class="built_in">push_back</span>(features[i][<span class="number">1</span>]);</span><br><span class="line">                    testResponsesData.<span class="built_in">push_back</span>(<span class="built_in">float</span>(label));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            img_index ++;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 做图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">plotTrainData</span><span class="params">(Mat trainData, Mat labels, <span class="type">float</span> *error=<span class="literal">NULL</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> area_max, ar_max, area_min, ar_min;</span><br><span class="line">    area_max= ar_max= <span class="number">0</span>;</span><br><span class="line">    area_min= ar_min= <span class="number">99999999</span>;</span><br><span class="line">    <span class="comment">// Get the min and max of each feature for normalize plot image</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt; trainData.rows; i++)&#123;</span><br><span class="line">        <span class="type">float</span> area= trainData.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i,<span class="number">0</span>);</span><br><span class="line">        <span class="type">float</span> ar= trainData.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(area &gt; area_max)</span><br><span class="line">            area_max= area;</span><br><span class="line">        <span class="keyword">if</span>( ar &gt; ar_max )</span><br><span class="line">            ar_max= ar;</span><br><span class="line">        <span class="keyword">if</span>(area &lt; area_min)</span><br><span class="line">            area_min= area;</span><br><span class="line">        <span class="keyword">if</span>(ar &lt; ar_min)</span><br><span class="line">            ar_min= ar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create Image for plot</span></span><br><span class="line">    Mat plot= Mat::<span class="built_in">zeros</span>(<span class="number">512</span>,<span class="number">512</span>,CV_8UC3);</span><br><span class="line">    <span class="comment">// Plot each of two features in a 2D graph using an image</span></span><br><span class="line">    <span class="comment">// where x is area and y is aspect ratio</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt; trainData.rows; i++)&#123;</span><br><span class="line">        <span class="comment">// Set the X y pos for each data</span></span><br><span class="line">        <span class="type">float</span> area= trainData.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i,<span class="number">0</span>);</span><br><span class="line">        <span class="type">float</span> ar= trainData.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i,<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> x= (<span class="type">int</span>)(<span class="number">512.0f</span>*((area-area_min)/(area_max-area_min)));</span><br><span class="line">        <span class="type">int</span> y= (<span class="type">int</span>)(<span class="number">512.0f</span>*((ar-ar_min)/(ar_max-ar_min)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get label</span></span><br><span class="line">        <span class="type">int</span> label= labels.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(i);</span><br><span class="line">        <span class="comment">// Set color depend of label</span></span><br><span class="line">        Scalar color;</span><br><span class="line">        <span class="keyword">if</span>(label==<span class="number">0</span>)</span><br><span class="line">            color= green; <span class="comment">// NUT</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(label==<span class="number">1</span>)</span><br><span class="line">            color= blue; <span class="comment">// ring</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(label==<span class="number">2</span>)</span><br><span class="line">            color= red; <span class="comment">// SCREW</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">circle</span>( plot,  <span class="built_in">Point</span>(x, y), <span class="number">3</span>,  color, <span class="number">-1</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(error!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        stringstream ss;</span><br><span class="line">        ss &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; *error &lt;&lt; <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        <span class="built_in">putText</span>(plot, ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>(), <span class="built_in">Point</span>(<span class="number">20</span>,<span class="number">512</span><span class="number">-40</span>), FONT_HERSHEY_SIMPLEX, <span class="number">0.75</span>, <span class="built_in">Scalar</span>(<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>), <span class="number">1</span>, LINE_AA);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;plot&quot;</span>, plot);</span><br><span class="line"><span class="comment">//    waitKey(0);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 训练并测试误差</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">trainAndTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">float</span>&gt; trainingData;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; responsesData;</span><br><span class="line">    vector&lt;<span class="type">float</span>&gt; testData;</span><br><span class="line">    vector&lt;<span class="type">float</span>&gt; testResponsesData;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> num_for_test = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取螺母图像</span></span><br><span class="line">    <span class="built_in">readFolderAndExtractFeatures</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/books/CV/2-ing/9781785280948_Code/&quot;</span></span><br><span class="line">                                         <span class="string">&quot;B04283_06_code/data/nut/tuerca_%04d.pgm&quot;</span>, <span class="number">0</span>,</span><br><span class="line">                                 num_for_test, trainingData, responsesData, testData, testResponsesData);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取螺丝圈图像</span></span><br><span class="line">    <span class="built_in">readFolderAndExtractFeatures</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/books/CV/2-ing/9781785280948_Code/&quot;</span></span><br><span class="line">                                         <span class="string">&quot;B04283_06_code/data/ring/arandela_%04d.pgm&quot;</span>, <span class="number">1</span>,</span><br><span class="line">                                 num_for_test, trainingData, responsesData, testData, testResponsesData);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取并处理螺丝</span></span><br><span class="line">    <span class="built_in">readFolderAndExtractFeatures</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/books/CV/2-ing/&quot;</span></span><br><span class="line">                                         <span class="string">&quot;9781785280948_Code/B04283_06_code/data/screw/tornillo_%04d.pgm&quot;</span>, <span class="number">2</span>,</span><br><span class="line">                                 num_for_test, trainingData, responsesData, testData, testResponsesData);</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Num of train samples: &quot;</span>&lt;&lt;responsesData.<span class="built_in">size</span>()&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Num of test samples: &quot;</span>&lt;&lt;testResponsesData.<span class="built_in">size</span>()&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 合并</span></span><br><span class="line">    <span class="comment">// Mat(int rows, int cols, int type, void* data, size_t step=AUTO_STEP);</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">trainingDataMat</span><span class="params">(trainingData.size()/<span class="number">2</span> ,<span class="number">2</span>, CV_32FC1, &amp;trainingData[<span class="number">0</span>])</span></span>;</span><br><span class="line">    <span class="function">Mat <span class="title">responses</span><span class="params">(responsesData.size(), <span class="number">1</span>, CV_32SC1, &amp;responsesData[<span class="number">0</span>])</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">testDataMat</span><span class="params">(testData.size()/<span class="number">2</span>, <span class="number">2</span>, CV_32FC1, &amp;testData[<span class="number">0</span>])</span></span>;</span><br><span class="line">    <span class="function">Mat <span class="title">testRespones</span><span class="params">(testResponsesData.size(), <span class="number">1</span>, CV_32FC1, &amp;testResponsesData[<span class="number">0</span>])</span></span>;</span><br><span class="line"></span><br><span class="line">    svm = SVM::<span class="built_in">create</span>();</span><br><span class="line">    svm-&gt;<span class="built_in">setType</span>(SVM::C_SVC);</span><br><span class="line">    svm-&gt;<span class="built_in">setKernel</span>(SVM::CHI2);</span><br><span class="line">    svm-&gt;<span class="built_in">setTermCriteria</span>(<span class="built_in">TermCriteria</span>(TermCriteria::MAX_ITER, <span class="number">100</span>, <span class="number">1e-6</span>));</span><br><span class="line"></span><br><span class="line">    svm-&gt;<span class="built_in">train</span>(trainingDataMat, ROW_SAMPLE, responses);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(testResponsesData.<span class="built_in">size</span>() &gt;<span class="number">0</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Evaluation&quot;</span>&lt;&lt;endl;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;============&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="comment">// test the ML model</span></span><br><span class="line">        Mat testPredict;</span><br><span class="line">        svm-&gt;<span class="built_in">predict</span>(testDataMat, testPredict);</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Prediction Done&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="comment">// error handle</span></span><br><span class="line">        Mat errorMat = testPredict != testRespones;</span><br><span class="line">        <span class="type">float</span> error = <span class="number">100.0f</span> * <span class="built_in">countNonZero</span>(errorMat) / testResponsesData.<span class="built_in">size</span>();</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Error: &quot;</span>&lt;&lt;error&lt;&lt;<span class="string">&quot;%&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="comment">//plot data</span></span><br><span class="line">        <span class="built_in">plotTrainData</span>(trainingDataMat, responses, &amp;error);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">plotTrainData</span>(trainingDataMat, responses);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">( <span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>** argv )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load image to process</span></span><br><span class="line">    Mat img= <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/books/CV/2-ing/9781785280948_Code/B04283_06_code/data/test.pgm&quot;</span>, IMREAD_GRAYSCALE);</span><br><span class="line">    <span class="keyword">if</span>(img.data==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Error loading image &quot;</span>&lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;img&quot;</span>, img);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load image to process</span></span><br><span class="line">    light_pattern= <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/light.pgm&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(light_pattern.data==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="comment">// Calculate light pattern</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;ERROR: Not light patter loaded&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">medianBlur</span>(light_pattern, light_pattern, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">trainAndTest</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//// Preprocess image</span></span><br><span class="line">    Mat pre= <span class="built_in">preprocessImage</span>(img);</span><br><span class="line">    <span class="comment">////End preprocess</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Extract features</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; pos_top, pos_left;</span><br><span class="line">    vector&lt; vector&lt;<span class="type">float</span>&gt; &gt; features= <span class="built_in">ExtractFeatures</span>(pre, &amp;pos_left, &amp;pos_top);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Num objects extracted features &quot;</span> &lt;&lt; features.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Mat img_output= img.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="built_in">cvtColor</span>(img_output, img_output, COLOR_GRAY2BGR);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt; features.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Data Area AR: &quot;</span> &lt;&lt; features[i][<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; features[i][<span class="number">1</span>] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        <span class="function">Mat <span class="title">trainingDataMat</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>, CV_32FC1, &amp;features[i][<span class="number">0</span>])</span></span>;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Features to predict: &quot;</span> &lt;&lt; trainingDataMat &lt;&lt; endl;</span><br><span class="line">        <span class="type">float</span> result= svm-&gt;<span class="built_in">predict</span>(trainingDataMat);</span><br><span class="line">        cout &lt;&lt; result &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        stringstream ss;</span><br><span class="line">        Scalar color;</span><br><span class="line">        <span class="keyword">if</span>(result==<span class="number">0</span>)&#123;</span><br><span class="line">            color= green; <span class="comment">// NUT</span></span><br><span class="line">            ss &lt;&lt; <span class="string">&quot;NUT&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(result==<span class="number">1</span>)&#123;</span><br><span class="line">            color= blue; <span class="comment">// RING</span></span><br><span class="line">            ss &lt;&lt; <span class="string">&quot;RING&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(result==<span class="number">2</span>)&#123;</span><br><span class="line">            color= red; <span class="comment">// SCREW</span></span><br><span class="line">            ss &lt;&lt; <span class="string">&quot;SCREW&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">putText</span>(img_output,</span><br><span class="line">                ss.<span class="built_in">str</span>(),</span><br><span class="line">                <span class="built_in">Point2d</span>(pos_left[i], pos_top[i]),</span><br><span class="line">                FONT_HERSHEY_SIMPLEX,</span><br><span class="line">                <span class="number">0.4</span>,</span><br><span class="line">                color);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//vector&lt;int&gt; results= evaluate(features);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Show images</span></span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Binary image&quot;</span>, pre);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Result&quot;</span>, img_output);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处的测试结果还是不错的，5个部件全部识别成功了。</p>
</blockquote>
<p>输出：</p>
<pre><code>Num of train samples: 146
Num of test samples: 67
Evaluation
============
Prediction Done
Error: 1.49254%
Num objects extracted features 5
Data Area AR: 2084 1.54013
Features to predict: [2084, 1.54013]
2
Data Area AR: 1171 1.12195
Features to predict: [1171, 1.1219512]
0
Data Area AR: 1045 1.97279
Features to predict: [1045, 1.9727893]
0
Data Area AR: 1486 1.12069
Features to predict: [1486, 1.1206896]
2
Data Area AR: 1620 1
Features to predict: [1620, 1]
1
</code></pre>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170518/Selection_051804.png" alt></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/18/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%88%86%E7%B1%BB/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://datahonor.com/2017/05/18/%E8%87%AA%E5%8A%A8%E5%85%89%E5%AD%A6%E6%A3%80%E6%B5%8B%EF%BC%8C%E7%9B%AE%E6%A0%87%E5%88%86%E5%89%B2%E5%92%8C%E6%A3%80%E6%B5%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/17157965?v=3&u=1787d5d04d50967c7825062bfff705ee584ae2b2&s=400">
      <meta itemprop="name" content="Mathew Shen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DATA HONOR">
      <meta itemprop="description" content="十年饮冰，难凉热血。">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | DATA HONOR">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/18/%E8%87%AA%E5%8A%A8%E5%85%89%E5%AD%A6%E6%A3%80%E6%B5%8B%EF%BC%8C%E7%9B%AE%E6%A0%87%E5%88%86%E5%89%B2%E5%92%8C%E6%A3%80%E6%B5%8B/" class="post-title-link" itemprop="url">自动光学检测，目标分割和检测</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-18 00:49:33" itemprop="dateCreated datePublished" datetime="2017-05-18T00:49:33+08:00">2017-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-13 12:35:03" itemprop="dateModified" datetime="2022-03-13T12:35:03+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2017/05/18/%E8%87%AA%E5%8A%A8%E5%85%89%E5%AD%A6%E6%A3%80%E6%B5%8B%EF%BC%8C%E7%9B%AE%E6%A0%87%E5%88%86%E5%89%B2%E5%92%8C%E6%A3%80%E6%B5%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/18/%E8%87%AA%E5%8A%A8%E5%85%89%E5%AD%A6%E6%A3%80%E6%B5%8B%EF%BC%8C%E7%9B%AE%E6%A0%87%E5%88%86%E5%89%B2%E5%92%8C%E6%A3%80%E6%B5%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Overview-65">Overview</h4>
<p>在复习CookBook的闲暇，看了看<em>OpenCV By Example</em>, 里面的示例很不错，这里做下记录。此处实现了目标的背景去除，目标的分割和检测，以工厂螺母为例。就是下面的图啦。</p>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170518/light.png" alt><br>
<img src="http://blog-1252464519.costj.myqcloud.com/170518/test.png" alt></p>
<h4 id="Code-54">Code</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by shensir on 17-5-17.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 光纹去除</span></span><br><span class="line"><span class="function">Mat <span class="title">removeLight</span><span class="params">(Mat img, Mat pattern, <span class="type">int</span> method)</span></span>&#123;</span><br><span class="line">    Mat aux;</span><br><span class="line">    <span class="comment">// 如果方法是归一化</span></span><br><span class="line">    <span class="keyword">if</span>(method==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">// 相除时需要将图像改为32位浮点型</span></span><br><span class="line">        Mat img32, pattern32;</span><br><span class="line">        img.<span class="built_in">convertTo</span>(img32, CV_32F);</span><br><span class="line">        pattern.<span class="built_in">convertTo</span>(pattern32, CV_32F);</span><br><span class="line">        <span class="comment">// 图像相除模式</span></span><br><span class="line">        aux = <span class="number">255</span>*(<span class="number">1</span>-(img32/pattern32));</span><br><span class="line">        <span class="comment">// 换回8bit</span></span><br><span class="line">        aux.<span class="built_in">convertTo</span>(aux, CV_8U);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        aux = pattern - img;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> aux;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 估计背景图像，大尺寸核矩阵模糊</span></span><br><span class="line"><span class="function">Mat <span class="title">calculateLightPattern</span><span class="params">(Mat img)</span></span>&#123;</span><br><span class="line">    Mat pattern;</span><br><span class="line">    <span class="built_in">blur</span>(img, pattern, <span class="built_in">Size</span>(img.cols/<span class="number">3</span>, img.rows/<span class="number">3</span>));</span><br><span class="line">    <span class="keyword">return</span> pattern;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先进行形态学操作[在背景色是核函数模糊得到的时候，很有必要]，再二值化</span></span><br><span class="line"><span class="function">Mat <span class="title">getBinary</span><span class="params">(Mat img_no_light, <span class="type">int</span> method_light)</span></span>&#123;</span><br><span class="line">    Mat img_thr;</span><br><span class="line">    <span class="keyword">if</span>(method_light!=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">threshold</span>(img_no_light, img_thr, <span class="number">30</span>, <span class="number">255</span>, THRESH_BINARY);</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">threshold</span>(img_no_light, img_thr, <span class="number">140</span>, <span class="number">255</span>, THRESH_BINARY_INV);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进行形态学操作去除边缘不规则噪点</span></span><br><span class="line">    cv::Mat closed;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">element5</span><span class="params">(<span class="number">5</span> ,<span class="number">5</span>, CV_8U, cv::Scalar(<span class="number">1</span>))</span></span>;</span><br><span class="line">    cv::<span class="built_in">morphologyEx</span>(img_thr, closed,   <span class="comment">// input and output</span></span><br><span class="line">                     cv::MORPH_CLOSE,  <span class="comment">// operator code</span></span><br><span class="line">                     element5);  <span class="comment">// structuring element</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Opening</span></span><br><span class="line">    cv::Mat opening;</span><br><span class="line">    cv::<span class="built_in">morphologyEx</span>(closed, opening,   <span class="comment">// input and output</span></span><br><span class="line">                     cv::MORPH_OPEN,  <span class="comment">// operator code</span></span><br><span class="line">                     element5);  <span class="comment">// structuring element</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;img_thr_closed-opening&quot;</span>, opening);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> opening;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> Scalar <span class="title">randomColor</span><span class="params">( RNG&amp; rng )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> icolor = (<span class="type">unsigned</span>) rng;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Scalar</span>( icolor&amp;<span class="number">255</span>, (icolor&gt;&gt;<span class="number">8</span>)&amp;<span class="number">255</span>, (icolor&gt;&gt;<span class="number">16</span>)&amp;<span class="number">255</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连通区域算法</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConnectedComponents</span><span class="params">(Mat img)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 使用连通区域分离符合要求部分图像Mat标签</span></span><br><span class="line">    Mat labels;</span><br><span class="line">    <span class="type">int</span> num_objects = <span class="built_in">connectedComponents</span>(img, labels);</span><br><span class="line">    <span class="comment">// 检查检测到的目标数目</span></span><br><span class="line">    <span class="keyword">if</span>(num_objects&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;No objects detected&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Number of objects detected: &quot;</span>&lt;&lt; num_objects<span class="number">-1</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建彩色目标的输出图像</span></span><br><span class="line">    Mat output=Mat::<span class="built_in">zeros</span>(img.rows, img.cols, CV_8UC3);</span><br><span class="line">    <span class="function">RNG <span class="title">rng</span><span class="params">(<span class="number">0xFFFFFFFF</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;num_objects; i++)&#123;</span><br><span class="line">        Mat mask = labels==i;</span><br><span class="line">        output.<span class="built_in">setTo</span>(<span class="built_in">randomColor</span>(rng), mask);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Result&quot;</span>, output);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 连通区域算法</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConnectedComponentsStats</span><span class="params">(Mat img)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 连通区域统计信息</span></span><br><span class="line">    Mat labels, stats, centroids;</span><br><span class="line">    <span class="type">int</span> num_objects = <span class="built_in">connectedComponentsWithStats</span>(img, labels, stats, centroids);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检测物体数目判别</span></span><br><span class="line">    <span class="keyword">if</span>(num_objects&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;No objects detedcted&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Number of objects detected: &quot;</span>&lt;&lt;num_objects<span class="number">-1</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建彩色对象的输出图像并显示区域</span></span><br><span class="line">    Mat output = Mat::<span class="built_in">zeros</span>(img.rows, img.cols, CV_8UC3);</span><br><span class="line">    <span class="function">RNG <span class="title">rng</span><span class="params">(<span class="number">0xFFFFFFFF</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;num_objects; i++)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Object &quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot; with pos: &quot;</span>&lt;&lt;centroids.<span class="built_in">at</span>&lt;Point2d&gt;(i)</span><br><span class="line">                                         &lt;&lt;<span class="string">&quot; with area &quot;</span>&lt;&lt;stats.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(i, CC_STAT_AREA)&lt;&lt;endl;</span><br><span class="line">        Mat mask = labels==i;</span><br><span class="line">        output.<span class="built_in">setTo</span>(<span class="built_in">randomColor</span>(rng), mask);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用区域绘制文本</span></span><br><span class="line">        stringstream ss;</span><br><span class="line">        ss&lt;&lt;<span class="string">&quot;area: &quot;</span>&lt;&lt;stats.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(i, CC_STAT_AREA);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">putText</span>(output, ss.<span class="built_in">str</span>(), centroids.<span class="built_in">at</span>&lt;Point2d&gt;(i), FONT_HERSHEY_SIMPLEX, <span class="number">0.4</span>, <span class="built_in">Scalar</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Result&quot;</span>, output);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  边缘检测算法</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FindContoursBasic</span><span class="params">(Mat img)</span></span>&#123;</span><br><span class="line">    vector&lt;vector&lt;Point&gt;&gt; contours;</span><br><span class="line">    <span class="built_in">findContours</span>(img, contours, RETR_EXTERNAL, CHAIN_APPROX_SIMPLE);</span><br><span class="line">    Mat output = Mat::<span class="built_in">zeros</span>(img.rows, img.cols, CV_8UC3);</span><br><span class="line">    <span class="comment">// 检查检测到的对象的数目</span></span><br><span class="line">    <span class="keyword">if</span>(contours.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;No objects detected&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Number of objects detected: &quot;</span>&lt;&lt;contours.<span class="built_in">size</span>()&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">RNG <span class="title">rng</span><span class="params">(<span class="number">0xFFFFFFFF</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;contours.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        <span class="built_in">drawContours</span>(output, contours, i, <span class="built_in">randomColor</span>(rng));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Contours&quot;</span>, output);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Mat img = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/industry.pgm&quot;</span>, IMREAD_GRAYSCALE);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Original Image&quot;</span>, img);</span><br><span class="line"></span><br><span class="line">    Mat pattern = <span class="built_in">imread</span>(<span class="string">&quot;/home/shensir/Documents/MyPrograming/Cpp/Clions/data/light.pgm&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Back&quot;</span>, pattern);</span><br><span class="line"><span class="comment">//    Mat pattern = calculateLightPattern(img);</span></span><br><span class="line">    Mat img_no_light = <span class="built_in">removeLight</span>(img, pattern, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;removelight--minus&quot;</span>, img_no_light);</span><br><span class="line"></span><br><span class="line">    Mat img_thr = <span class="built_in">getBinary</span>(img_no_light,<span class="number">1</span>);</span><br><span class="line"><span class="comment">//    ConnectedComponents(img_thr);</span></span><br><span class="line">    <span class="built_in">ConnectedComponentsStats</span>(img_thr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">FindContoursBasic</span>(img_thr);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>Number of objects detected: 4<br>
Object 1 with pos: [160.203, 143.822] with area 2315<br>
Object 2 with pos: [263.535, 131.804] with area 1820<br>
Object 3 with pos: [52.7045, 143.926] with area 1171<br>
Object 4 with pos: [68.233, 202.819] with area 1618<br>
Number of objects detected: 4</p>
</blockquote>
<p><img src="http://blog-1252464519.costj.myqcloud.com/170518/Selection_051801.png" alt></p>
<h4 id="待改进的地方">待改进的地方</h4>
<p>在没有背景色图的时候，我们直接通过大尺寸核矩阵模糊化得到的效果很差，得到的objects大于50左右，后面自己加上了形态学的操作，降到了5个，但是还是多了一个。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/18/%E8%87%AA%E5%8A%A8%E5%85%89%E5%AD%A6%E6%A3%80%E6%B5%8B%EF%BC%8C%E7%9B%AE%E6%A0%87%E5%88%86%E5%89%B2%E5%92%8C%E6%A3%80%E6%B5%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/archives/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/archives/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/18/">18</a><a class="extend next" rel="next" href="/archives/page/11/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mathew Shen</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




<script class="next-config" data-name="valine" type="application/json">{"enable":true,"appId":"qzF75hQvs6yPkMIO7gd7LwDB-gzGzoHsz","appKey":"foULNoeGLTL8LE8C2Ysitv5I","serverURLs":["datahonor.com"],"placeholder":"毕竟今天太阳那么好~(评论时留下邮箱才能收到回复提醒的邮件哦)","avatar":"","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":["nick"],"notify":true,"el":"#valine-comments","path":"/archives/page/10/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.valine.el)
    .then(() => NexT.utils.getScript(
      'https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js',
      { condition: window.Valine }
    ))
    .then(() => {
      new Valine(CONFIG.valine);
    });
});
</script>

</body>
</html>
